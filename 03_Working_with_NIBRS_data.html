<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Greg Ridgeway">
<meta name="dcterms.date" content="2025-08-01">

<title>Introduction to NIBRS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="03_Working_with_NIBRS_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="03_Working_with_NIBRS_data_files/libs/quarto-html/quarto.js"></script>
<script src="03_Working_with_NIBRS_data_files/libs/quarto-html/popper.min.js"></script>
<script src="03_Working_with_NIBRS_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="03_Working_with_NIBRS_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="03_Working_with_NIBRS_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="03_Working_with_NIBRS_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="03_Working_with_NIBRS_data_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="03_Working_with_NIBRS_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="03_Working_with_NIBRS_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="03_Working_with_NIBRS_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="03_Working_with_NIBRS_data_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="03_Working_with_NIBRS_data_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="03_Working_with_NIBRS_data_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#national-incident-based-reporting-system" id="toc-national-incident-based-reporting-system" class="nav-link active" data-scroll-target="#national-incident-based-reporting-system"><span class="header-section-number">1</span> National Incident-Based Reporting System</a></li>
  <li><a href="#acquiring-the-data" id="toc-acquiring-the-data" class="nav-link" data-scroll-target="#acquiring-the-data"><span class="header-section-number">2</span> Acquiring the data</a></li>
  <li><a href="#reading-in-the-data" id="toc-reading-in-the-data" class="nav-link" data-scroll-target="#reading-in-the-data"><span class="header-section-number">3</span> Reading in the data</a>
  <ul class="collapse">
  <li><a href="#administrative-segment" id="toc-administrative-segment" class="nav-link" data-scroll-target="#administrative-segment"><span class="header-section-number">3.1</span> Administrative segment</a></li>
  <li><a href="#offense-segment" id="toc-offense-segment" class="nav-link" data-scroll-target="#offense-segment"><span class="header-section-number">3.2</span> Offense segment</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">3.2.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#property-segment" id="toc-property-segment" class="nav-link" data-scroll-target="#property-segment"><span class="header-section-number">3.3</span> Property segment</a></li>
  <li><a href="#victim-segment" id="toc-victim-segment" class="nav-link" data-scroll-target="#victim-segment"><span class="header-section-number">3.4</span> Victim segment</a></li>
  <li><a href="#offender-segment" id="toc-offender-segment" class="nav-link" data-scroll-target="#offender-segment"><span class="header-section-number">3.5</span> Offender segment</a></li>
  <li><a href="#arrestee-segment" id="toc-arrestee-segment" class="nav-link" data-scroll-target="#arrestee-segment"><span class="header-section-number">3.6</span> Arrestee segment</a></li>
  <li><a href="#batch-header-segment" id="toc-batch-header-segment" class="nav-link" data-scroll-target="#batch-header-segment"><span class="header-section-number">3.7</span> Batch Header segment</a></li>
  <li><a href="#saving-our-work" id="toc-saving-our-work" class="nav-link" data-scroll-target="#saving-our-work"><span class="header-section-number">3.8</span> Saving our work</a></li>
  </ul></li>
  <li><a href="#examples-using-nibrs" id="toc-examples-using-nibrs" class="nav-link" data-scroll-target="#examples-using-nibrs"><span class="header-section-number">4</span> Examples using NIBRS</a>
  <ul class="collapse">
  <li><a href="#what-percentage-of-burglaries-result-in-an-arrest" id="toc-what-percentage-of-burglaries-result-in-an-arrest" class="nav-link" data-scroll-target="#what-percentage-of-burglaries-result-in-an-arrest"><span class="header-section-number">4.1</span> What percentage of burglaries result in an arrest?</a></li>
  <li><a href="#what-percentage-of-crimes-are-cleared-with-an-arrest-by-month-in-which-the-offense-occurred" id="toc-what-percentage-of-crimes-are-cleared-with-an-arrest-by-month-in-which-the-offense-occurred" class="nav-link" data-scroll-target="#what-percentage-of-crimes-are-cleared-with-an-arrest-by-month-in-which-the-offense-occurred"><span class="header-section-number">4.2</span> What percentage of crimes are cleared with an arrest by month in which the offense occurred?</a></li>
  <li><a href="#what-is-the-range-of-times-to-arrest-for-crimes-resulting-in-arrest" id="toc-what-is-the-range-of-times-to-arrest-for-crimes-resulting-in-arrest" class="nav-link" data-scroll-target="#what-is-the-range-of-times-to-arrest-for-crimes-resulting-in-arrest"><span class="header-section-number">4.3</span> What is the range of times to arrest for crimes resulting in arrest?</a></li>
  </ul></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">5</span> Exercises</a></li>
  <li><a href="#answers-to-the-exercises" id="toc-answers-to-the-exercises" class="nav-link" data-scroll-target="#answers-to-the-exercises"><span class="header-section-number">6</span> Answers to the exercises</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="03_Working_with_NIBRS_data.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to NIBRS</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Greg Ridgeway <a href="mailto:gridge@upenn.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Pennsylvania
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 1, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- In terminal -->
<!-- quarto render 03_Working_with_NIBRS_data.qmd -->
<!-- git commit 03_* -m "commit message" -->
<!-- git status -->
<!-- git push -->
<!-- A function for automating the numbering and wording of the exercise questions -->
<section id="national-incident-based-reporting-system" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> National Incident-Based Reporting System</h1>
<p>The FBI established the Uniform Crime Reporting (UCR) Program in 1930 to generate reliable crime statistics for law enforcement administration, operation, and management. It has been the primary source of crime data in the United States for decades.</p>
<p>The UCR’s Summary Reporting System (SRS) is the best-known component of the UCR. About 18,000 law enforcement agencies, including municipal police departments, sheriff’s departments, campus police, transit police, park police, and many other agencies, reported monthly counts of Part 1 crimes (murder and non-negligent manslaughter, forcible rape, robbery, aggravated assault, burglary, larceny theft, motor vehicle theft, and arson), often called “index crimes.” The SRS also tracked monthly counts of Part II crimes, such as simple assault, fraud, vandalism, drug offenses, and driving under the influence. Even though reporting to the SRS was voluntary, almost all law enforcement agencies reported their data, offering fairly comprehensive coverage of crimes reported to the police in the United States.</p>
<p>While the UCR SRS has provided valuable crime data for many years, it has several notable limitations. The SRS focused on a limited number of crimes, potentially overlooking important details and emerging trends. With SRS data researchers cannot separate out trends in shootings, identity theft, and cybercrimes. Shootings, for example, are lumped together in an aggravated assault category that includes a range of serious assaults like striking someone with a beer bottle. The SRS also operated under the “Hierarchy Rule,” reporting only the most severe offense in a multi-offense incident. Lastly, the SRS only collected aggregate counts, meaning that detailed information about the context of the crimes, such as the characteristics of the victims and offenders, the extent of property loss or damage, the time, place, and context of the crime, and the relationships between these crime features, is lost.</p>
<p>The FBI introduced the National Incident-Based Reporting System (NIBRS) in the 1980s. NIBRS aimed to address the shortcomings of the SRS by capturing incident-level data and a comprehensive description of what happened in each incident. Unlike the SRS, NIBRS collects data on each individual crime incident, capturing detailed information about the offenses, victims, offenders, property, and arrestees. NIBRS records data on 52 “Group A” offenses and 10 “Group B” offenses, covering a broader spectrum of criminal activity. It did away with the Hierarchy Rule and collects data on all offenses within a single incident, providing a fuller picture of criminal activity. Because NIBRS is incident-based, we have full access to the multivariate relationships between features of crime incidents.</p>
<p>On January 1, 2021, the FBI officially retired the SRS marking a significant transition towards the exclusive use of the National Incident-Based Reporting System for crime data collection and reporting. Although the transition has been planned for almost a decade, many law enforcement agencies are yet to transition their information systems to report to NIBRS. As of this writing, four of the nation’s largest states, California, New York, Pennsylvania, and Florida, essentially do not participate in NIBRS. You can find a <a href="https://bjs.ojp.gov/national-incident-based-reporting-system-nibrs">map describing NIBRS coverage</a> at the Bureau of Justice Statistics. The largest law enforcement agencies in those states regularly post crime data to their local open data portals, but you will not find those data in NIBRS yet. The transition to NIBRS also makes the study of long-term national crime trends challenging. Any study that spans the SRS-NIBRS transition will have to grapple with inconsistencies and gaps in data as agencies adapt to the new system.</p>
<p>The FBI accepts data from law enforcement agencies through March of the following year. That is, the FBI accepted NIBRS data for 2023 through March 2024. Some crimes committed in December 2023, for example, may be solved or result in an arrest in April 2024. Such a case would not get marked as “cleared” in the NIBRS data since the clearance came after the NIBRS 2023 submission end date. Crimes in January 2023 may seem to be solved at a higher rate than crimes in December 2023 because of the March 2024 censoring. This is a feature of the data that simply requires care. Lastly, like the SRS, NIBRS only has data on those crimes reported to the police and reporting rates can vary greatly by type of crime.</p>
<p>In this document, you will walk through running the nibrs.R script, which processes NIBRS data from 2023. The steps will cover reading the dataset, segmenting data by type (e.g., offenders, victims), and performing some exploration of the NIBRS data.</p>
</section>
<section id="acquiring-the-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Acquiring the data</h1>
<p>The complete NIBRS data are available from the FBI’s Crime Data Explorer <a href="https://cde.ucr.cjis.gov/LATEST/webapp/#/pages/downloads">downloads page</a> under the Master File Downloads section heading. from the dropdown menu select “National Incident-Based Reporting System (NIBRS). The compressed data file, <code>nibrs-2023.zip</code>, is over 500 Mb so downloading will take some time. It has over 73 million rows of data. Unzip <code>nibrs-2023.zip</code>. It is very big… about 6 Gb. I then run <code>gzip 2023_NIBRS_NATIONAL_MASTER_FILE.TXT</code> from the Terminal pane in RStudio (not the Console pane, the Terminal pane is typically one tab to the right of the Console pane).</p>
<p>Let’s start by loading a few libraries that we will need and peeking at a few lines of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">scan</span>(<span class="st">"2023_NIBRS_NATIONAL_MASTER_FILE.txt.gz"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">nlines=</span><span class="dv">5</span>, <span class="at">what=</span><span class="st">""</span>, <span class="at">sep=</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "BH50AK0010100000000000000                ANCHORAGE                     AK1C941Y         3030020A         00028502600  39000000000000000000      000000000000000000      000000000000000000      000000000000000000      000000000  002023NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN020            "
[2] "BH50AK0010200000000000000        20210101FAIRBANKS                     AK4 941Y         3030020AA        00003196100 258000000000000000000      000000000000000000      000000000000000000      000000000000000000      00000000012122023NYNNYNNYNNYNNYNNYNNYNNYNNYNNYNNYNNYN090            "
[3] "0150AK001020023000003    20230101 11010010100    N                                      N"                                                                                                                                                                                                   
[4] "0250AK001020023000003    2023010123DCN  04               88"                                                                                                                                                                                                                                 
[5] "0350AK001020023000003    20230101775000000150                                                         "                                                                                                                                                                                      </code></pre>
</div>
</div>
<p>As you can see the data are not pretty. This data is in “fixed-width format”. Rather than separate each column of data with a delimiter (like a comma or tab), all of the data fields are placed side by side. This is a legacy format that has some benefits. First, there is no need to store delimiters. This is less important these days with cheap data storage, but storing delimiters in a dataset this size requires about 1 Gb… just to store a bunch of commas. Instead, the data come with a separate file that describes which columns of text correspond to different columns of data. The following table shows the first five rows of the NIBRS offense segment in the included <code>NIBRS Records Description updated.xlsx</code> file.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 30%">
<col style="width: 54%">
</colgroup>
<thead>
<tr class="header">
<th>Positions</th>
<th>Field Length and Type</th>
<th>Field Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1-2</td>
<td>A2</td>
<td>SEGMENT LEVEL</td>
</tr>
<tr class="even">
<td>3-4</td>
<td>N2</td>
<td>NUMERIC STATE CODE</td>
</tr>
<tr class="odd">
<td>5-13</td>
<td>A9</td>
<td>ORIGINATING AGENCY IDENTIFIER (ORI)</td>
</tr>
<tr class="even">
<td>14-25</td>
<td>A12</td>
<td>INCIDENT NUMBER</td>
</tr>
<tr class="odd">
<td>26-33</td>
<td>A8</td>
<td>INCIDENT DATE</td>
</tr>
<tr class="even">
<td>34-36</td>
<td>A3</td>
<td>UCR OFFENSE CODE</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>The table tells us that for offense segments, the first two characters represent the segment level, characters 3 and 4 capture the state numeric code, characters 5-13 capture the ORI (a unique identifier for a law enforcement agency), and so one. The second column describes the data type, (A)lphanumeric or (N)umeric, and the width (number of characters) of the data field. Let’s start by discussing the segment level. The NIBRS data is more complex than an already complex fixed-width format data file. The NIBRS data involve several data tables, separate tables for offenses, victims, offenders, property, and arrests. The data file we just loaded interleaves all of these tables. Note that the fourth row of the data we scanned in starts with “02” that signals that the rest of that row describes an offense and its format will align with the formatting table shown here. Since characters 3-4 are “50” we know from the format table that this number represents the state with code “50,” which turns out to be Alaska. The next nine characters (AK0010200) is the ORI code for the law enforcement agency that reported the offense, which turns out to be the Fairbanks Police Department. If we look further to the right in that fourth row of data to characters 26-33 we get “20230101,” which is the data of the criminal incident, January 1, 2023. And the three characters after the date give the offense code “23D,” which is the code for theft from a building.</p>
<p>This interpretation only works for lines of data with the first two characters equal to “02”. The others are</p>
<table class="table">
<thead>
<tr class="header">
<th>Segment code</th>
<th>Segment type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BH</td>
<td>batch header</td>
</tr>
<tr class="even">
<td>01</td>
<td>administrative</td>
</tr>
<tr class="odd">
<td>02</td>
<td>offenses</td>
</tr>
<tr class="even">
<td>03</td>
<td>property</td>
</tr>
<tr class="odd">
<td>04</td>
<td>victims</td>
</tr>
<tr class="even">
<td>05</td>
<td>offender</td>
</tr>
<tr class="odd">
<td>06</td>
<td>arrestee</td>
</tr>
<tr class="even">
<td>07</td>
<td>Group B arrests</td>
</tr>
<tr class="odd">
<td>W1</td>
<td>Incomplete admin</td>
</tr>
<tr class="even">
<td>W3</td>
<td>Incomplete property</td>
</tr>
<tr class="odd">
<td>W6</td>
<td>Incomplete arrest</td>
</tr>
</tbody>
</table>
<p>We will read each of these in and explore what they contain. The W1, W2, and W3 are “window segments” and represent a partial reporting. These are relatively rare records and mostly relate to arrests or recovered property related to offenses that do not appear in the 02 segment, most likely because the agency transitioned to NIBRS between the offense and the recovery/arrest.</p>
</section>
<section id="reading-in-the-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Reading in the data</h1>
<p>Here’s the strategy that we will use to read in the data. The data might be too big to read in all at once and still have computer memory available to clean and organize the data. Instead of reading all of it in, we are going to read in one million rows at a time. We will then examine the first two characters of each row and split rows of data by those first two characters. In this way, all the offense records will be together, and all the victim records will be together, and so one. Then we will write out all the records into segment specific files. Our computers will then have a separate file for each of the NIBRS segments.</p>
<p>First, I set up <code>infile</code> to connect to the large NIBRS data file, opening it in (r)ead model. Next, I set up eight files, one for each of the segments, creating them in (w)rite mode to be gzip’d (compressed) as they are created. Then I set up a while-loop to continue to read one million lines at a time as long as there are more rows of data to read in. Within the loop I use <code>split()</code> to separate the lines of data I have read in based on the first two characters of the line. I combine the few window segments with the similar complete records (e.g.&nbsp;window segment on property goes with the rest of the property data). Lastly, inside the loop I write out the new batch of data, appending them to existing data from previous iterations of the while-loop. Closing all the files makes sure that all the read and write buffers get flushed to the data files and the connections are closed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set the file we want to 'r'ead</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>infile  <span class="ot">&lt;-</span> <span class="fu">file</span>(<span class="st">"2023_NIBRS_NATIONAL_MASTER_FILE.txt.gz"</span>,<span class="st">'r'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create the files we are going to 'w'rite</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>outfile <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"01"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-01.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"02"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-02.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"03"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-03.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"04"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-04.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">"05"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-05.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"06"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-06.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">"07"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-07.txt.gz"</span>, <span class="st">'w'</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"BH"</span><span class="ot">=</span><span class="fu">gzfile</span>(<span class="st">"2023-BH.txt.gz"</span>, <span class="st">'w'</span>))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># read in 1,000,000 lines at a time</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>cLines <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> ((<span class="fu">length</span>(a <span class="ot">&lt;-</span> <span class="fu">readLines</span>(infile, <span class="at">n=</span><span class="dv">1000000</span>)) <span class="sc">&gt;</span>  <span class="dv">0</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># split up what we read based on first two characters BH, 01, 02, ...</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">split</span>(a, <span class="fu">substring</span>(a,<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># combine window segments with the associated segments</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  b[[<span class="st">"01"</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(b[[<span class="st">"01"</span>]],b[[<span class="st">"W1"</span>]]) <span class="co"># administrative</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  b[[<span class="st">"03"</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(b[[<span class="st">"03"</span>]],b[[<span class="st">"W3"</span>]]) <span class="co"># property</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  b[[<span class="st">"06"</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(b[[<span class="st">"06"</span>]],b[[<span class="st">"W6"</span>]]) <span class="co"># arrestees</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  b[<span class="fu">c</span>(<span class="st">"W1"</span>,<span class="st">"W3"</span>,<span class="st">"W6"</span>)] <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># drop the W1, W3, W6</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># write each segment to its own file</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(iSegment <span class="cf">in</span> <span class="fu">names</span>(b))</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">writeLines</span>(b[[iSegment]], <span class="at">con=</span>outfile[[iSegment]])</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span>(infile)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(iSegment <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">close</span>(outfile[[iSegment]])</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now with the segments separated into their own files, we can read them each in individually.</p>
<p>The Excel file <code>NIBRS Records Description updated.xlsx</code> contains all the information about which columns in which segments contain which data field. It is probably a good idea to open the file in Excel and explore what is in there and how the file is structured. We will start by reading in the second sheet called “INCIDENT RECORD” using <code>read_excel()</code> from the <code>readxl</code> library. Note that <code>range</code> is set to just capture the part of the sheet with the information that we need. So, the first row in <code>fmtXL</code> will be the row with the header: Data Field Number, Position, Type/Length, Description.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>fmtXL <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"NIBRS Records Description updated.xlsx"</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sheet =</span> <span class="st">"INCIDENT RECORD"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">range =</span> <span class="st">"A5:D819"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">DataField=</span><span class="st">`</span><span class="at">Data Field Number</span><span class="st">`</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">TypeLength=</span><span class="st">`</span><span class="at">Type/ Length</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="administrative-segment" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="administrative-segment"><span class="header-section-number">3.1</span> Administrative segment</h2>
<p>We will start by reading in segment 01, the administrative segment, where the records description lies between rows 3 and 100 in <code>fmtXL</code>. I’m going to use <code>grep()</code> to find out where the description of the next segment (LEVEL 02, the offense segment) starts so I know where the end of the administrative segment is. I am also going to drop those rows where <code>Position</code> is missing and where <code>Position=="59-88"</code>, which is redundant with other record descriptions which provide more details about the contents between characters 59 and 88 in administrative records.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only the rows for admin segment</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "02"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">3</span><span class="sc">:</span>(i<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"59-88"</span>))) <span class="co"># up to 10 UCR codes</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>fmt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 4
   DataField Position TypeLength Description                                    
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;                                          
 1 &lt;NA&gt;      1-2      A2         "SEGMENT LEVEL - Designates this as the Admini…
 2 &lt;NA&gt;      3-4      N2         "NUMERIC STATE CODE - This is a two-digit valu…
 3 1         5-13     A9         "ORIGINATING AGENCY IDENTIFIER (ORI) - This id…
 4 2         14-25    A12        "INCIDENT NUMBER - This is a unique case numbe…
 5 3         26-33    A8         "INCIDENT DATE - This is the date that the inc…
 6 &lt;NA&gt;      34       A1         "REPORT DATE INDICATOR - If value is \"R\" = R…
 7 &lt;NA&gt;      35-36    A2         "INCIDENT DATE HOUR - This is the military tim…
 8 &lt;NA&gt;      37-38    N2         "TOTAL OFFENSE SEGMENTS - This is the number o…
 9 &lt;NA&gt;      39-41    N3         "TOTAL VICTIM SEGMENTS - This is the number of…
10 &lt;NA&gt;      42-43    N2         "TOTAL OFFENDER SEGMENTS - This is the number …
# ℹ 15 more rows</code></pre>
</div>
</div>
<p><code>fmt</code> now contains everything we need to know about how to interpret the administrative data. We are going to use <code>read_fwf()</code> from the <code>readr</code> package to read in the fixed-width formatted administrative segment (R also has a <code>read.fwf()</code> function, but it is extremely slow with large files). <code>read_fwf()</code> needs to know how wide each column is and whether it is of type character (c) or of type numeric (n). The <code>TypeLength</code> column in <code>fmt</code> has this information. If the first character is an A (alphanumeric) then I will set <code>fmtType</code> to “c”, otherwise I will set it to “n”. Then the rest of the <code>TypeLength</code> field I will store in <code>fmtWidth</code>. Lastly, I will need to create some column names for the dataset and I see that the part of the <code>Description</code> column before the hyphen has a suitable column name. I’ll use <code>strsplit()</code> to separate the <code>Description</code> at the ” - ” and keep only the first part for the column names. <code>make.names()</code> converts the names to syntactically valid R variable names, replacing invalid characters like spaces and # with a period instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span>            <span class="co"># get first character</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)  <span class="co"># convert A-&gt;c, N-&gt;n</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span>   <span class="co"># get everything after the first character</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()      <span class="co"># turn text to a number</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_) <span class="co"># turn .. into one . or delete trailing .</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Time to read in the administrative segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in the data from fixed width format</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    R also has a read.fwf() function but it is very slow</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>nibrsAdmin01 <span class="ot">&lt;-</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">read_fwf</span>(<span class="st">"2023-01.txt.gz"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">col_type=</span><span class="fu">paste</span>(fmtType, <span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at the first three rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nibrsAdmin01 <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">3</span>, <span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12,351,743 × 25
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE REPORT.DATE.INDICATOR
  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;                
1 01         50 AK0010200 23000003        20230101      &lt;NA&gt;                 
2 01         50 AK0010200 23000005        20230101      &lt;NA&gt;                 
3 01         50 AK0010200 23000011        20230102      &lt;NA&gt;                 
  INCIDENT.DATE.HOUR TOTAL.OFFENSE.SEGMENTS TOTAL.VICTIM.SEGMENTS
  &lt;chr&gt;                               &lt;dbl&gt;                 &lt;dbl&gt;
1 11                                      1                     1
2 15                                      1                     1
3 16                                      1                     1
  TOTAL.OFFENDER.SEGMENTS TOTAL.ARRESTEE.SEGMENTS CITY.SUBMISSION
                    &lt;dbl&gt;                   &lt;dbl&gt; &lt;chr&gt;          
1                       1                       0 &lt;NA&gt;           
2                       1                       0 &lt;NA&gt;           
3                       2                       0 &lt;NA&gt;           
  CLEARED.EXCEPTIONALLY EXCEPTIONAL.CLEARANCE.DATE OFFENSE.CODE.1 OFFENSE.CODE.2
  &lt;chr&gt;                 &lt;chr&gt;                      &lt;chr&gt;          &lt;chr&gt;         
1 N                     &lt;NA&gt;                       &lt;NA&gt;           &lt;NA&gt;          
2 N                     &lt;NA&gt;                       &lt;NA&gt;           &lt;NA&gt;          
3 N                     &lt;NA&gt;                       &lt;NA&gt;           &lt;NA&gt;          
  OFFENSE.CODE.3 OFFENSE.CODE.4 OFFENSE.CODE.5 OFFENSE.CODE.6 OFFENSE.CODE.7
  &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;         
1 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;          
2 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;          
3 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;          
  OFFENSE.CODE.8 OFFENSE.CODE.9 OFFENSE.CODE.10 Cargo.Theft.Indicator
  &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;           &lt;chr&gt;                
1 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;            N                    
2 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;            N                    
3 &lt;NA&gt;           &lt;NA&gt;           &lt;NA&gt;            N                    
# ℹ 12,351,740 more rows</code></pre>
</div>
</div>
<p>The first row describes one incident, occurring in Alaska (STATE=50), reported to the Fairbanks Police Department (ORI=AK0010200), that occurred on January 1, 2023 at around 11am. The incident number, 23000003, is only unique within an agency. There may be other incidents that other law enforcement agencies reported that have the same incident number. Whenever linking this record to learn more about the offense, victims, property, and arrests, be sure to join on <em>both</em> the ORI <em>and</em> the incident number. The first row also tells us that this incident involved one particular offense, involving one victim and one offender, with no arrests (at least through the cutoff date of March 15, 2024).</p>
</section>
<section id="offense-segment" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="offense-segment"><span class="header-section-number">3.2</span> Offense segment</h2>
<p>Let’s move on to loading the offense data. NIBRS reports all “Group A offenses” in the offense table. Group A offenses are mostly crimes against a person or property. NIBRS includes crime types based on</p>
<ul>
<li>seriousness of offense</li>
<li>frequency of its occurrence</li>
<li>prevalence nationwide</li>
<li>probability the offense comes to police attention</li>
<li>law enforcement is the best channel for collecting data</li>
<li>burden placed on law enforcement to collect data</li>
<li>validity and usefulness of the collected data</li>
<li>legitimate general interest in offense</li>
</ul>
<p>A <a href="https://bjs.ojp.gov/sites/g/files/xyckuh236/files/media/document/offensea_offenseb.pdf">complete list of offenses</a> that fall into Group A can be found at the Bureau of Justice Statistics website. Generally, Group A includes arson, assault, burglary, counterfeiting, vandalism, drugs, extortion, fraud, gambling, homicide, human trafficking, kidnapping, theft, motor vehicle theft, obscene material, prostitution, robbery, sex offenses, and weapons offenses. You will not find reports of Group B offenses in the offense segment. Group B offenses include writing bad checks, curfew violations, loitering, disorderly conduct, drunk driving, family offenses, peeping tom, trespassing, and other non-violent offenses. These crimes only get included in NIBRS arrest segment if there is an arrest. Reports from the public about Group B offenses do not make it into the offense segment.</p>
<p>As with the administrative segment, we will extract from the Excel records description the offense segment’s format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only the rows for offense segment,</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   everything between LEVEL 02 and LEVEL 03</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "02"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "03"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"38-40"</span>,<span class="st">"46-48"</span>,<span class="st">"49-57"</span>)))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>fmt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 4
   DataField Position TypeLength Description                                    
   &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;                                          
 1 &lt;NA&gt;      1-2      A2         "SEGMENT LEVEL - Designates this as the Offens…
 2 &lt;NA&gt;      3-4      N2         "NUMERIC STATE CODE - This is a two-digit valu…
 3 1         5-13     A9         "ORIGINATING AGENCY IDENTIFIER (ORI) - This id…
 4 2         14-25    A12        "INCIDENT NUMBER - This is a unique case numbe…
 5 3         26-33    A8         "INCIDENT DATE - This is the same date value f…
 6 6         34-36    A3         "UCR OFFENSE CODE"                             
 7 7         37       A1         "OFFENSE ATTEMPTED/COMPLETED - This indicates …
 8 8         38       A1         "SUSPECTED OF USING #1"                        
 9 8         39       A1         "SUSPECTED OF USING #2"                        
10 8         40       A1         "SUSPECTED OF USING #3"                        
# ℹ 11 more rows</code></pre>
</div>
</div>
<p>This <code>fmt</code> is similar in structure to the one we saw for the administrative segment, just with a different set of features, ones more specific to the offense, like the UCR code of the offense and whether it was attempted or completed. Let’s use <code>read_fwf()</code> to read in the offense data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-02.txt.gz"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s pull up the offense record for the Fairbanks, Alaska incident 2300003 that was in the first row of the administrative segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span> <span class="fu">filter</span>(INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>(<span class="at">n=</span><span class="dv">3</span>, <span class="at">width=</span><span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 91 × 21
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE UCR.OFFENSE.CODE
  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           
1 02         50 AK0010200 23000003        20230101      23D             
2 02         50 AK0010900 23000003        20230101      290             
3 02          2 AZ0071300 23000003        20230101      520             
# ℹ 88 more rows
# ℹ 15 more variables: OFFENSE.ATTEMPTED.COMPLETED &lt;chr&gt;,
#   SUSPECTED.OF.USING.1 &lt;chr&gt;, SUSPECTED.OF.USING.2 &lt;chr&gt;,
#   SUSPECTED.OF.USING.3 &lt;chr&gt;, LOCATION.TYPE &lt;chr&gt;,
#   NUMBER.OF.PREMISES.ENTERED &lt;chr&gt;, METHOD.OF.ENTRY &lt;chr&gt;,
#   CRIMINAL.ACTIVITY.1.GANG.INFORMATION.1 &lt;chr&gt;,
#   CRIMINAL.ACTIVITY.2.GANG.INFORMATION.2 &lt;chr&gt;, CRIMINAL.ACTIVITY.3 &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Note here that I only filtered on the incident number. What we got back were all incidents labeled as incident number 23000003, including those from other police departments. Remember that incident numbers are only unique within a law enforcement agency. So, we need to also specifically request the incident from Fairbanks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span> <span class="sc">&amp;</span> INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 21
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE UCR.OFFENSE.CODE
  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           
1 02         50 AK0010200 23000003        20230101      23D             
  OFFENSE.ATTEMPTED.COMPLETED SUSPECTED.OF.USING.1 SUSPECTED.OF.USING.2
  &lt;chr&gt;                       &lt;chr&gt;                &lt;chr&gt;               
1 C                           N                    &lt;NA&gt;                
  SUSPECTED.OF.USING.3 LOCATION.TYPE NUMBER.OF.PREMISES.ENTERED METHOD.OF.ENTRY
  &lt;chr&gt;                &lt;chr&gt;         &lt;chr&gt;                      &lt;chr&gt;          
1 &lt;NA&gt;                 04            &lt;NA&gt;                       &lt;NA&gt;           
  CRIMINAL.ACTIVITY.1.GANG.INFORMATION.1 CRIMINAL.ACTIVITY.2.GANG.INFORMATION.2
  &lt;chr&gt;                                  &lt;chr&gt;                                 
1 &lt;NA&gt;                                   &lt;NA&gt;                                  
  CRIMINAL.ACTIVITY.3 WEAPON.FORCE.1 AUTOMATIC.INDICATOR.1 WEAPON.FORCE.2
  &lt;chr&gt;               &lt;chr&gt;          &lt;chr&gt;                 &lt;chr&gt;         
1 &lt;NA&gt;                &lt;NA&gt;           &lt;NA&gt;                  &lt;NA&gt;          
  WEAPON.FORCE.3 BIAS.MOTIVATION
  &lt;chr&gt;          &lt;chr&gt;          
1 &lt;NA&gt;           88             </code></pre>
</div>
</div>
<p>This offense record describes a UCR code 23D, which is theft from a building. <code>OFFENSE.ATTEMPTED.COMPLETED</code> is <code>C</code> meaning it was a completed crime (not attempted). During the offense the offender was suspected of using narcotics (<code>SUSPECTED.OF.USING.1</code> marked as <code>N</code>). Location type is <code>04</code>, which is a Church/Synagogue/Temple.</p>
<p>You have noticed by now that NIBRS has a lot of codes, for states, offenses, location types, and there are many more. It might be handy to have a lookup table so we can join the codes to better English descriptions. All the information is in that Excel records description. Let’s write some code to create a UCR lookup table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">which</span>(fmtXL<span class="sc">$</span>Description<span class="sc">==</span><span class="st">"720 - Animal Cruelty Offenses - Animal Cruelty"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">which</span>(fmtXL<span class="sc">$</span>Description<span class="sc">==</span><span class="st">"90Z - All Other Offenses - All Other Offenses"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>OffenseLookup <span class="ot">&lt;-</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(fmtXL<span class="sc">$</span>Description[i<span class="sc">:</span>j], <span class="st">" - "</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">do.call</span>(rbind, <span class="at">args=</span>_) <span class="sc">|&gt;</span> <span class="co"># stack all the rows on top of each other</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">UCRCode=</span>X1, <span class="at">CrimeCat=</span>X2, <span class="at">Crime=</span>X3) <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(UCRCode<span class="sc">!=</span><span class="st">"Group B Offenses"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(OffenseLookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  UCRCode                CrimeCat              Crime
1     720 Animal Cruelty Offenses     Animal Cruelty
2     200                   Arson              Arson
3     13A        Assault Offenses Aggravated Assault
4     13B        Assault Offenses     Simple Assault
5     13C        Assault Offenses       Intimidation
6     510                 Bribery            Bribery</code></pre>
</div>
</div>
<p>Now for each UCR offense code we can look up its general crime category (<code>CrimeCat</code>) and its specific crime type (<code>Crime</code>). You can adapt this code to create other lookup tables for other codes, like a state code lookup table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">which</span>(fmtXL<span class="sc">$</span>Description<span class="sc">==</span><span class="st">"50  = AK -Alaska"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">which</span>(fmtXL<span class="sc">$</span>Description<span class="sc">==</span><span class="st">"49  =  WY -  Wyoming"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>StateLookup <span class="ot">&lt;-</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   fmtXL<span class="sc">$</span>Description[i<span class="sc">:</span>j] <span class="sc">|&gt;</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">temp=</span>fmtXL.Description.i.j.) <span class="sc">|&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">StateCode=</span><span class="fu">as.numeric</span>(<span class="fu">substring</span>(temp,<span class="dv">1</span>,<span class="dv">2</span>)),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">State=</span><span class="fu">gsub</span>(<span class="st">".*([A-Z][A-Z]).*"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, temp)) <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="sc">-</span>temp) <span class="sc">|&gt;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(StateCode)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(StateLookup)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  StateCode State
1         1    AL
2         2    AZ
3         3    AR
4         4    CA
5         5    CO
6         6    CT</code></pre>
</div>
</div>
<section id="exercises" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">3.2.1</span> Exercises</h3>
<ol type="1">
<li><p>How many Group A offenses were reported to the Philadelphia Police Department (ORI PAPEP0000)?</p></li>
<li><p>What is the most commonly reported crime in Philadelphia? Use the OffenseLookup to replace the UCR codes with crime descriptions.</p></li>
</ol>
</section>
</section>
<section id="property-segment" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="property-segment"><span class="header-section-number">3.3</span> Property segment</h2>
<p>Moving on to the NIBRS property segment, we repeat the same steps as we did before, adapting to get the records description for property reports.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only the rows for property segment</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "03"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "04"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((i<span class="sc">+</span><span class="dv">2</span>)<span class="sc">:</span>(j<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"14-22"</span>,<span class="st">"20-22"</span>,<span class="st">"58-102"</span>,<span class="st">"58-72"</span>,<span class="st">"103-132"</span>)))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are two columns called <code>ESTIMATED.QUANTITY</code>. The second one represents thousandths of the first column. So, I’ll rename the second one to have a unique name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fmtNames</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "SEGMENT.LEVEL"                      "NUMERIC.STATE.CODE"                
 [3] "ORIGINATING.AGENCY.IDENTIFIER.ORI"  "INCIDENT.NUMBER"                   
 [5] "INCIDENT.DATE"                      "TYPE.PROPERTY.LOSS.ETC"            
 [7] "PROPERTY.DESCRIPTION"               "VALUE.OF.PROPERTY"                 
 [9] "DATE.RECOVERED"                     "NUMBER.OF.STOLEN.MOTOR.VEHICLES"   
[11] "NUMBER.OF.RECOVERED.MOTOR.VEHICLES" "SUSPECTED.DRUG.TYPE"               
[13] "ESTIMATED.QUANTITY"                 "ESTIMATED.QUANTITY"                
[15] "TYPE.MEASUREMENT"                   "DRUG.INVOLVEMENT.2"                
[17] "DRUG.INVOLVEMENT.3"                 "WINDOW.UCR.OFFENSE.CODE.1"         
[19] "WINDOW.UCR.OFFENSE.CODE.2"          "WINDOW.UCR.OFFENSE.CODE.3"         
[21] "WINDOW.UCR.OFFENSE.CODE.4"          "WINDOW.UCR.OFFENSE.CODE.5"         
[23] "WINDOW.UCR.OFFENSE.CODE.6"          "WINDOW.UCR.OFFENSE.CODE.7"         
[25] "WINDOW.UCR.OFFENSE.CODE.8"          "WINDOW.UCR.OFFENSE.CODE.9"         
[27] "WINDOW.UCR.OFFENSE.CODE.10"        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fmtNames[<span class="fu">which</span>(fmtNames<span class="sc">==</span><span class="st">"ESTIMATED.QUANTITY"</span>)[<span class="dv">2</span>]] <span class="ot">&lt;-</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">"ESTIMATED.QUANTITY.1000THS"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>nibrsProp03 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-03.txt.gz"</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">VALUE.OF.PROPERTY=</span><span class="fu">as.numeric</span>(VALUE.OF.PROPERTY)) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s pull up the property record for the Fairbanks, Alaska incident 2300003 that we previously examined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>nibrsProp03 <span class="sc">|&gt;</span>  </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span> <span class="sc">&amp;</span> INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">360</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 27
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE TYPE.PROPERTY.LOSS.ETC
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;                 
1 03      50    AK0010200 23000003        20230101      7                     
  PROPERTY.DESCRIPTION VALUE.OF.PROPERTY DATE.RECOVERED NUMBER.OF.STOLEN.MOTOR…¹
  &lt;chr&gt;                            &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;                   
1 75                                 150 &lt;NA&gt;           &lt;NA&gt;                    
  NUMBER.OF.RECOVERED.MOTOR.VEHICLES SUSPECTED.DRUG.TYPE ESTIMATED.QUANTITY
  &lt;chr&gt;                              &lt;chr&gt;               &lt;chr&gt;             
1 &lt;NA&gt;                               &lt;NA&gt;                &lt;NA&gt;              
  ESTIMATED.QUANTITY.10…² TYPE.MEASUREMENT DRUG.INVOLVEMENT.2 DRUG.INVOLVEMENT.3
  &lt;chr&gt;                   &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;             
1 &lt;NA&gt;                    &lt;NA&gt;             &lt;NA&gt;               &lt;NA&gt;              
  WINDOW.UCR.OFFENSE.CODE.1 WINDOW.UCR.OFFENSE.CODE.2 WINDOW.UCR.OFFENSE.CODE.3
  &lt;chr&gt;                     &lt;chr&gt;                     &lt;chr&gt;                    
1 &lt;NA&gt;                      &lt;NA&gt;                      &lt;NA&gt;                     
# ℹ abbreviated names: ¹​NUMBER.OF.STOLEN.MOTOR.VEHICLES, ²​ESTIMATED.QUANTITY.1000THS
# ℹ 7 more variables: WINDOW.UCR.OFFENSE.CODE.4 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.5 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.6 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.7 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.8 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.9 &lt;chr&gt;, WINDOW.UCR.OFFENSE.CODE.10 &lt;chr&gt;</code></pre>
</div>
</div>
<p>This incident involved something stolen (<code>TYPE.PROPERTY.LOSS.ETC</code> equal to 7). The thing that was stolen was “Portable Electronic Communications” (<code>PROPERTY.DESCRIPTION</code> code is 75), which most likely means a mobile phone. The estimated value of the phone was $150.</p>
<p>Importantly, the value of property stored in <code>VALUE.OF.PROPERTY</code> is not always the actual value. NIBRS codes certain special values in <code>VALUE.OF.PROPERTY</code>.</p>
<ul>
<li>1 = the value of the property is unknown</li>
<li>NA = the property was seized (<code>TYPE.PROPERTY.LOSS.ETC</code> is 6) and the seized property was drugs/narcotics (<code>PROPERTY.DESCRIPTION</code> is 10)</li>
<li>the value of drugs will be present if they were damaged, destroyed, or stolen when the offense is not a narcotics violation, such as arson, burglary, or robbery.</li>
</ul>
</section>
<section id="victim-segment" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="victim-segment"><span class="header-section-number">3.4</span> Victim segment</h2>
<p>We repeat the same process for the victim segment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "04"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "05"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"37-66"</span>,<span class="st">"74-77"</span>,<span class="st">"79-83"</span>,<span class="st">"84-123"</span>)))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>nibrsVic04 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-04.txt.gz"</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s pull up the property record for the Fairbanks, Alaska incident 2300003 that we previously examined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nibrsVic04 <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span> <span class="sc">&amp;</span> INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">360</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 44
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE VICTIM.SEQUENCE.NUMBER
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;                          &lt;dbl&gt;
1 04      50    AK0010200 23000003        20230101                           1
  UCR.OFFENSE.CODE.1 UCR.OFFENSE.CODE.2 UCR.OFFENSE.CODE.3 UCR.OFFENSE.CODE.4
  &lt;chr&gt;              &lt;chr&gt;              &lt;chr&gt;              &lt;chr&gt;             
1 23D                &lt;NA&gt;               &lt;NA&gt;               &lt;NA&gt;              
  UCR.OFFENSE.CODE.5 UCR.OFFENSE.CODE.6 UCR.OFFENSE.CODE.7 UCR.OFFENSE.CODE.8
  &lt;chr&gt;              &lt;chr&gt;              &lt;chr&gt;              &lt;chr&gt;             
1 &lt;NA&gt;               &lt;NA&gt;               &lt;NA&gt;               &lt;NA&gt;              
  UCR.OFFENSE.CODE.9 UCR.OFFENSE.CODE.10 TYPE.OF.VICTIM AGE.OF.VICTIM
  &lt;chr&gt;              &lt;chr&gt;               &lt;chr&gt;          &lt;chr&gt;        
1 &lt;NA&gt;               &lt;NA&gt;                I              61           
  SEX.OF.VICTIM RACE.OF.VICTIM ETHNICITY.OF.VICTIM RESIDENT.STATUS.OF.VICTIM
  &lt;chr&gt;         &lt;chr&gt;          &lt;chr&gt;               &lt;chr&gt;                    
1 M             W              N                   R                        
# ℹ 22 more variables: CIRCUMSTANCE.1 &lt;chr&gt;, CIRCUMSTANCE.2 &lt;chr&gt;, ADDITIONAL.JUSTIFIABLE.HOMICIDE.CIRCUMSTANCES &lt;chr&gt;, INJURY.1 &lt;chr&gt;, INJURY.2 &lt;chr&gt;, INJURY.3 &lt;chr&gt;, INJURY.4 &lt;chr&gt;, INJURY.5 &lt;chr&gt;, OFFENDER.NUMBER.TO.BE.RELATED &lt;chr&gt;, RELATIONSHIP.OF.VICTIM.TO.OFFENDER &lt;chr&gt;, RELATIONSHIP.2 &lt;chr&gt;, RELATIONSHIP.3 &lt;chr&gt;, RELATIONSHIP.4 &lt;chr&gt;,
#   RELATIONSHIP.5 &lt;chr&gt;, RELATIONSHIP.6 &lt;chr&gt;, RELATIONSHIP.7 &lt;chr&gt;, RELATIONSHIP.8 &lt;chr&gt;, RELATIONSHIP.9 &lt;chr&gt;, RELATIONSHIP.10 &lt;chr&gt;, Type.of.Activity.Officer.Circumstance &lt;chr&gt;, Assignment.Type.Officer &lt;chr&gt;, ORI.Other.Jurisdiction.Officer &lt;chr&gt;</code></pre>
</div>
</div>
<p>Here we see that <code>TYPE.OF.VICTIM</code> is I, meaning that the victim was an individual (instead of a business, government, society, or some other institutional victim). The individual is a 61 year old non-Hispanic white male. No other information is available for this victim, but police can record the relationship between the victim and offender, whether the victim sustained any injuries, what drew the officer to the victim (such as a traffic stop or responding to a call for service), and whether the victim killed the offender in self-defense.</p>
</section>
<section id="offender-segment" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="offender-segment"><span class="header-section-number">3.5</span> Offender segment</h2>
<p>A few more segments to go. Now we will read in the data on the offenders.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "05"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "06"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((i<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(j<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position))</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>nibrsOff05 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-05.txt.gz"</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In some years the offender data has some text in the <code>OFFENDER.SEQUENCE.NUMBER</code> for some reason, like setting the <code>OFFENDER.SEQUENCE.NUMBER</code> to “##”. We told <code>read_fwf()</code> to expect a numeric value for this column, marked by the “n” in the <code>fmtType</code> column here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(fmtNames, fmtType)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            fmtNames fmtType
1                      SEGMENT.LEVEL       c
2                 NUMERIC.STATE.CODE       c
3  ORIGINATING.AGENCY.IDENTIFIER.ORI       c
4                    INCIDENT.NUMBER       c
5                      INCIDENT.DATE       c
6           OFFENDER.SEQUENCE.NUMBER       n
7                    AGE.OF.OFFENDER       c
8                    SEX.OF.OFFENDER       c
9                   RACE.OF.OFFENDER       c
10             Ethnicity.OF.OFFENDER       c</code></pre>
</div>
</div>
<p>If this should happen, you can explore the problem a little to find the problem in the original data using <code>problems(nibrsOff05)</code>. My preferred solution is just to read all columns in as text and worry about fixing the non-numeric values later. Here I set all of the value of <code>col_type</code> to character.</p>
<!-- No such errors occur with 2023 data -->
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nibrsOff05 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-05.txt.gz"</span>,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_type=</span><span class="st">"cccccccccc"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have no description of the offender in this case.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nibrsOff05 <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span> <span class="sc">&amp;</span> INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">360</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 10
  SEGMENT STATE ORI       INCIDENT.NUMBER INCIDENT.DATE OFFENDER.SEQUENCE.NUMBER
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;           &lt;chr&gt;                            &lt;dbl&gt;
1 05      50    AK0010200 23000003        20230101                             0
  AGE.OF.OFFENDER SEX.OF.OFFENDER RACE.OF.OFFENDER Ethnicity.OF.OFFENDER
  &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;                
1 &lt;NA&gt;            &lt;NA&gt;            &lt;NA&gt;             &lt;NA&gt;                 </code></pre>
</div>
</div>
</section>
<section id="arrestee-segment" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="arrestee-segment"><span class="header-section-number">3.6</span> Arrestee segment</h2>
<p>If the reporting agency arrests an offender for the reported offense after submitting the initial report, the agency later submits an updated arrestee segment as an update to the initial report. The <a href="https://le.fbi.gov/file-repository/nibrs-user-manual.pdf">NIBRS User’s Manual</a> notes that as cases develop, police can update, delete, or add to previously submitted records. However, the submission date cuts off on March 15 of subsequent year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only the rows for victim segment</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "06"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "07"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((i<span class="sc">+</span><span class="dv">2</span>)<span class="sc">:</span>(j<span class="dv">-3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"61-66"</span>,<span class="st">"75-104"</span>)))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>nibrsArr06 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-06.txt.gz"</span>,</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No arrests were made in this case. You probably already suspected this since there was no description of an offender in this case either.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>nibrsArr06 <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span> <span class="sc">&amp;</span> INCIDENT.NUMBER<span class="sc">==</span><span class="st">"23000003"</span>) <span class="sc">|&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1     0</code></pre>
</div>
</div>
<p>Group B arrestees are kept in a separate data file. Group B offenses are almost all crimes against society, such as bad checks, non-violent family offenses, curfew/loitering/vagrancy, liquor law violations, disorderly conduct, peeping Tom, DUI, trespassing, drunkenness. These offenses are only reported if the police made an arrest. That is, someone calls the police reporting some disorderly conduct, the police do not record that in NIBRS unless they end up making an arrest as a result of the call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">'LEVEL "07"'</span>, fmtXL<span class="sc">$</span>DataField)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> fmtXL <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span>i)) <span class="sc">|&gt;</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="st">"44-49"</span>))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>TypeLength <span class="sc">|&gt;</span> </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>nibrsArB07 <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-07.txt.gz"</span>,</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Fairbanks case we traced through the other NIBRS tables was not a Group B offense, so it will have no records in this table. Instead, let’s examine the first two Fairbanks Group B offenses reported. I have gone ahead and joined the Group B arrestee table with the <code>OffenseLookup</code> so the offenses are easier to interpret.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>nibrsArB07 <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"AK0010200"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(OffenseLookup, <span class="at">by=</span><span class="fu">join_by</span>(UCR.GROUP.B.ARREST.OFFENSE.CODE<span class="sc">==</span>UCRCode)) <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">360</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 20
  SEGMENT STATE ORI       ARREST.TRANSACTION.INCIDENT.NUMBER ARREST.DATE
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;                              &lt;chr&gt;      
1 07      50    AK0010200 50901                              20230206   
2 07      50    AK0010200 50908                              20230102   
  ARRESTEE.SEQUENCE.NUMBER CITY.SUBMISSION TYPE.OF.ARREST
                     &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;         
1                        1 &lt;NA&gt;            T             
2                        1 &lt;NA&gt;            O             
  UCR.GROUP.B.ARREST.OFFENSE.CODE WEAPON.1 AUTOMATIC.INDICATOR.1 WEAPON.2
  &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;                 &lt;chr&gt;   
1 90F                             01       &lt;NA&gt;                  &lt;NA&gt;    
2 90C                             01       &lt;NA&gt;                  &lt;NA&gt;    
  AGE.OF.ARRESTEE SEX.OF.ARRESTEE RACE.OF.ARRESTEE ETHNICITY.OF.ARRESTEE
  &lt;chr&gt;           &lt;chr&gt;           &lt;chr&gt;            &lt;chr&gt;                
1 45              M               W                N                    
2 35              F               I                N                    
  RESIDENT.STATUS.OF.ARRESTEE DISPOSITION.OF.ARRESTEE.UNDER.18 CrimeCat    Crime
  &lt;chr&gt;                       &lt;chr&gt;                            &lt;chr&gt;       &lt;chr&gt;
1 R                           &lt;NA&gt;                             Family Off… Fami…
2 N                           &lt;NA&gt;                             Disorderly… Diso…</code></pre>
</div>
</div>
<p>Police arrested the first individual listed here based on a warrant for a prior incident (<code>TYPE.OF.ARREST</code> is “T”) for non-violent family offenses (e.g.&nbsp;neglect, not paying alimony). <code>WEAPON.1</code> equal to “01” indicates that the individual was unarmed. Age, race, sex information is also provided in this arrestee table.</p>
</section>
<section id="batch-header-segment" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="batch-header-segment"><span class="header-section-number">3.7</span> Batch Header segment</h2>
<p>The final segment we will read in is the batch header file. This file contains basic information about the agencies reporting to NIBRS. It contains one record for each law enforcement agency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>fmt <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"NIBRS Records Description updated.xlsx"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">skip=</span><span class="dv">4</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Position) <span class="sc">&amp;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>              <span class="sc">!</span>(Position <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"106-225"</span>, <span class="co"># data on county can repeat 5x</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"234-269"</span>, <span class="co"># indicators for 12 months</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"234"</span>,<span class="st">"235"</span>,<span class="st">"236"</span>, <span class="co"># detailed January reporting</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"270-284"</span>))) <span class="co"># county codes up to 5x</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>fmtType <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Type..Length <span class="sc">|&gt;</span> </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">case_match</span>(<span class="st">"A"</span><span class="sc">~</span><span class="st">"c"</span>,<span class="st">"N"</span><span class="sc">~</span><span class="st">"n"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>fmtWidth <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Type..Length <span class="sc">|&gt;</span> </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">substring</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>()</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>fmtNames <span class="ot">&lt;-</span> fmt<span class="sc">$</span>Description <span class="sc">|&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">strsplit</span>(<span class="at">split =</span> <span class="st">" - "</span>, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sapply</span>(head, <span class="at">n=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">make.names</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.+(</span><span class="sc">\\</span><span class="st">.|$)"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="ot">&lt;-</span> <span class="fu">read_fwf</span>(<span class="st">"2023-BH.txt.gz"</span>,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_positions =</span> <span class="fu">fwf_widths</span>(fmtWidth),</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">col_type=</span><span class="fu">paste</span>(fmtType,<span class="at">collapse=</span><span class="st">""</span>)) <span class="sc">|&gt;</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename_with</span>(<span class="sc">~</span>fmtNames) <span class="sc">|&gt;</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">rename</span>(<span class="at">ORI=</span>ORIGINATING.AGENCY.IDENTIFIER.ORI,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">SEGMENT=</span>SEGMENT.LEVEL,</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">STATE=</span>NUMERIC.STATE.CODE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some particularly important columns are <code>DATE.ORI.WENT.NIBRS</code> containing the date when the agency first reported data to NIBRS, the <code>AGENCY.INDICATOR</code> describing what type of law enforcement agency it is (eg. city, county, state, college, tribal) or whether the agency relies on another to file its NIBRS reports (such as a transit police that reports through the municipal police). The batch header contains an estimate of the size of the population that the agency covers, but breaks down the reporting by county. Oklahoma City, for example, intersects with four different counties, so that the Oklahoma City Police Department reports their population separately for each.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="sc">|&gt;</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"OK0550600"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ORI,CITY.NAME,STATE.ABBREVIATION,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">starts_with</span>(<span class="st">"CURRENT.POPULATION"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">360</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 8
  ORI       CITY.NAME     STATE.ABBREVIATION CURRENT.POPULATION.1
  &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;                             &lt;dbl&gt;
1 OK0550600 OKLAHOMA CITY OK                               532970
  CURRENT.POPULATION.2 CURRENT.POPULATION.3 CURRENT.POPULATION.4
                 &lt;dbl&gt;                &lt;dbl&gt;                &lt;dbl&gt;
1                88049                79665                   80
  CURRENT.POPULATION.5
                 &lt;dbl&gt;
1                    0</code></pre>
</div>
</div>
<p>I find it helpful to have a total population covered.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="ot">&lt;-</span> nibrsBH <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">TOTAL.POP=</span><span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"CURRENT.POP"</span>)), <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The batch header also contains information on whether the agency regularly reports their data. For example, here is the record for San Jose, California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="sc">|&gt;</span> <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"CA0431300"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ORI, CITY.NAME, STATE.ABBREVIATION, DATE.ORI.WENT.NIBRS,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>          NUMBER.OF.MONTHS.REPORTED, JANUARY<span class="sc">:</span>DECEMBER) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 17
  ORI       CITY.NAME STATE.ABBREVIATION DATE.ORI.WENT.NIBRS
  &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;              &lt;chr&gt;              
1 CA0431300 SAN JOSE  CA                 20230401           
  NUMBER.OF.MONTHS.REPORTED JANUARY FEBRUARY MARCH APRIL MAY   JUNE  JULY 
  &lt;chr&gt;                     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 07                        NNN     NNN      NNN   NYN   NYN   NYN   NYN  
  AUGUST SEPTEMBER OCTOBER NOVEMBER DECEMBER
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   
1 NYN    NYN       NYN     NNN      NNN     </code></pre>
</div>
</div>
<p>This record shows that they started reporting to NIBRS in April 2023 and reported for a total of 7 months. The <code>JANUARY</code> to <code>DECEMBER</code> columns describe more precisely what the agency submitted. The “NNN” indicates no reporting of any kind to NIBRS, occurring January, February, and March and then again in November and December. The “NYN” pattern means that the agency did not report (the first “N”) a “Zero Report” (a formal notice of no crime reports), did report Group A or Group B offenses (the “Y”), and did not report any window records (the final N, meaning there was no partial reporting, like an arrest without an associated offense report).</p>
<p>Let’s explore which agencies are reporting to NIBRS so we have a better sense of what NIBRS includes and excludes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NYPD, LAPD, and Nashville PD</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="sc">|&gt;</span>  </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NY0303000"</span>,<span class="st">"CA0194200"</span>,<span class="st">"TN0190100"</span>)) <span class="sc">|&gt;</span>    </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ORI, CITY.NAME, STATE.ABBREVIATION, DATE.ORI.WENT.NIBRS,</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>          NUMBER.OF.MONTHS.REPORTED, JANUARY<span class="sc">:</span>DECEMBER) <span class="sc">|&gt;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 17
  ORI       CITY.NAME   STATE.ABBREVIATION DATE.ORI.WENT.NIBRS
  &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;              &lt;chr&gt;              
1 CA0194200 LOS ANGELES CA                 &lt;NA&gt;               
2 NY0303000 NEW YORK    NY                 20230101           
3 TN0190100 NASHVILLE   TN                 19991001           
  NUMBER.OF.MONTHS.REPORTED JANUARY FEBRUARY MARCH APRIL MAY   JUNE  JULY 
  &lt;chr&gt;                     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 00                        NNN     NNN      NNN   NNN   NNN   NNN   NNN  
2 12                        NYN     NYN      NYN   NYN   NYN   NYN   NYN  
3 12                        NYN     NYN      NYN   NYN   NYN   NYN   NYN  
  AUGUST SEPTEMBER OCTOBER NOVEMBER DECEMBER
  &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;   
1 NNN    NNN       NNN     NNN      NNN     
2 NYN    NYN       NYN     NYN      NYN     
3 NYN    NYN       NYN     NYN      NYN     </code></pre>
</div>
</div>
<p>Los Angeles PD has never reported to NIBRS, New York City started their NIBRS reporting in 2023, and Nashville has been reporting to NIBRS for 25 years, since 1999 and continues to report its crime data every month.</p>
<p>Which states seem to have good reporting?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(COVERED.BY.ORI)) <span class="sc">|&gt;</span> <span class="co"># remove those reporting through another</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(STATE.ABBREVIATION, AGENCY.NIBRS.FLAG) <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> AGENCY.NIBRS.FLAG, </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">inNIBRS=</span>A, <span class="at">notInNIBRS=</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
   STATE.ABBREVIATION inNIBRS notInNIBRS
   &lt;chr&gt;                &lt;int&gt;      &lt;int&gt;
 1 AK                      32          7
 2 AL                     415         31
 3 AR                     313          3
 4 AZ                     100         26
 5 CA                     634        225
 6 CO                     245          4
 7 CT                     108          0
 8 DC                       2          1
 9 DE                      63          0
10 FL                     133        625
11 GA                     499        164
12 GM                       1          1
13 HI                       4          0
14 IA                     286          3
15 ID                     112          0
16 IL                     635        288
17 IN                     260         97
18 KS                     406          2
19 KY                     436          1
20 LA                     165         70
21 MA                     398         22
22 MD                     139         18
23 ME                     131          0
24 MI                     634          2
25 MN                     409          2
26 MO                     537         62
27 MS                     168        108
28 MT                     115          0
29 NB                     283          4
30 NC                     442         93
31 ND                     111          0
32 NH                     216          5
33 NJ                     346        232
34 NM                     104         26
35 NV                      61         11
36 NY                     185        405
37 OH                     813         42
38 OK                     462          0
39 OR                     234          3
40 PA                     171       1306
41 PR                       0          1
42 RI                      48          1
43 SC                     513          1
44 SD                     141          0
45 TN                     411          1
46 TX                    1393         84
47 UT                     144          2
48 VA                     420          0
49 VI                       0          2
50 VT                      87          0
51 WA                     270          0
52 WI                     394         64
53 WV                     426          4
54 WY                      53         17</code></pre>
</div>
</div>
<p>The states that have a large number of non-reporting agencies are California, Florida, Georgia, Illinois, New Jersey, New York, and Pennsylvania. These are rather large states. In the event that the non-reporting agencies are small, it is probably better to assess the percentage of the population covered by NIBRS rather than counting non-reporting agencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nibrsBH <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(COVERED.BY.ORI)) <span class="sc">|&gt;</span> <span class="co"># remove those reporting through another</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATE.ABBREVIATION, AGENCY.NIBRS.FLAG) <span class="sc">|&gt;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">populationCovered=</span><span class="fu">sum</span>(TOTAL.POP)) <span class="sc">|&gt;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> AGENCY.NIBRS.FLAG, </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> populationCovered,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">inNIBRS=</span>A, <span class="at">notInNIBRS=</span><span class="st">`</span><span class="at">NA</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentCovered=</span><span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>inNIBRS<span class="sc">/</span>(inNIBRS<span class="sc">+</span>notInNIBRS))) <span class="sc">|&gt;</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(percentCovered) <span class="sc">|&gt;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   STATE.ABBREVIATION [10]
   STATE.ABBREVIATION  inNIBRS notInNIBRS percentCovered
   &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;
 1 PR                        0    3205691              0
 2 VI                        0      83265              0
 3 FL                  9583627   13027099             42
 4 PA                  5605372    7356311             43
 5 AK                   445330     288076             61
 6 AZ                  4664949    2766395             63
 7 CA                 25034801   13930392             64
 8 MS                  1905988    1033702             65
 9 NJ                  6351608    2939233             68
10 NY                 13614572    5956644             70</code></pre>
</div>
</div>
<p>The states with large populations that NIBRS does not cover are Florida, Pennsylvania, and California.</p>
</section>
<section id="saving-our-work" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="saving-our-work"><span class="header-section-number">3.8</span> Saving our work</h2>
<p>Save the NIBRS 2023 data in its R format. If you ever want to reload the data, there will be no need to rerun all the previous steps. You can just use <code>load("nibrs2023.RData")</code> to retrieve the data. It will be quite large and can take a few minutes to reload.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(nibrsAdmin01, nibrsCrm02, nibrsProp03, nibrsVic04, nibrsOff05,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>     nibrsArr06, nibrsArB07, nibrsBH,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>     fmtXL,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">file=</span><span class="st">"nibrs2023.RData"</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">compress =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="examples-using-nibrs" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Examples using NIBRS</h1>
<p>For several of these examples we are going to need to work with dates. So, let’s start by converting all the dates to proper date formats.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="ot">&lt;-</span> nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">INCIDENT.DATE =</span> <span class="fu">ymd</span>(INCIDENT.DATE))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>nibrsArr06 <span class="ot">&lt;-</span> nibrsArr06 <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">INCIDENT.DATE =</span> <span class="fu">ymd</span>(INCIDENT.DATE),</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">ARREST.DATE =</span> <span class="fu">ymd</span>(ARREST.DATE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="what-percentage-of-burglaries-result-in-an-arrest" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="what-percentage-of-burglaries-result-in-an-arrest"><span class="header-section-number">4.1</span> What percentage of burglaries result in an arrest?</h2>
<p>Remember that arrest data only go through March 15 of the subsequent year. Note that the arrest will show up only if the agency records the arrest by March 15, 2024. Let’s start this example by finding the right UCR codes for burglary. Note that <code>str_detect()</code> is equivalent to <code>grepl()</code>. You may use either of them in such <code>filter()</code> statements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>OffenseLookup <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(Crime, <span class="st">"[Bb]urglary"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  UCRCode                     CrimeCat                        Crime
1     220 Burglary/Breaking &amp; Entering Burglary/Breaking &amp; Entering</code></pre>
</div>
</div>
<p>We will use UCR code 220 to select all the burglary offenses and check that <code>OFFENSE.ATTEMPTED.COMPLETED</code> equals “C” to eliminate the attempted burglaries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="sc">==</span><span class="st">"220"</span> <span class="sc">&amp;</span>            <span class="co"># burglary offense code </span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>         OFFENSE.ATTEMPTED.COMPLETED<span class="sc">==</span><span class="st">"C"</span>) <span class="sc">|&gt;</span> <span class="co"># completed</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ORI, INCIDENT.NUMBER) <span class="sc">|&gt;</span> <span class="co"># incidents are only unique within ORI</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> <span class="co"># remove any duplicate ORI/INCIDENT.NUMBER combos</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compress arrest data to ORI, INCIDENT.NUMBER, and first arrest</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nibrsArr06 <span class="sc">|&gt;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(ORI, INCIDENT.NUMBER) <span class="sc">|&gt;</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarize</span>(<span class="at">dataFirstArrest =</span> <span class="fu">min</span>(ARREST.DATE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.groups=</span><span class="st">"drop"</span>),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pctArrest =</span> <span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(dataFirstArrest)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  pctArrest
      &lt;dbl&gt;
1     0.136</code></pre>
</div>
</div>
</section>
<section id="what-percentage-of-crimes-are-cleared-with-an-arrest-by-month-in-which-the-offense-occurred" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="what-percentage-of-crimes-are-cleared-with-an-arrest-by-month-in-which-the-offense-occurred"><span class="header-section-number">4.2</span> What percentage of crimes are cleared with an arrest by month in which the offense occurred?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">INCIDENT.MONTH=</span><span class="fu">month</span>(INCIDENT.DATE, <span class="at">label=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ORI, INCIDENT.NUMBER, INCIDENT.MONTH) <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nibrsArr06 <span class="sc">|&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(ORI, INCIDENT.NUMBER) <span class="sc">|&gt;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>               <span class="fu">summarize</span>(<span class="at">dataFirstArrest =</span> <span class="fu">min</span>(ARREST.DATE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.groups=</span><span class="st">"drop"</span>),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(INCIDENT.MONTH) <span class="sc">|&gt;</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pctArrest =</span> <span class="fu">mean</span>(<span class="sc">!</span><span class="fu">is.na</span>(dataFirstArrest)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   INCIDENT.MONTH pctArrest
   &lt;ord&gt;              &lt;dbl&gt;
 1 Jan                0.246
 2 Feb                0.248
 3 Mar                0.249
 4 Apr                0.248
 5 May                0.244
 6 Jun                0.241
 7 Jul                0.241
 8 Aug                0.242
 9 Sep                0.244
10 Oct                0.238
11 Nov                0.243
12 Dec                0.242</code></pre>
</div>
</div>
</section>
<section id="what-is-the-range-of-times-to-arrest-for-crimes-resulting-in-arrest" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="what-is-the-range-of-times-to-arrest-for-crimes-resulting-in-arrest"><span class="header-section-number">4.3</span> What is the range of times to arrest for crimes resulting in arrest?</h2>
<p>This next example shows the issue with the March 15 cutoff for reporting to NIBRS. Have a look at the average time and maximum time to arrest by month of the incident. The results seem to suggest that crimes resulting in arrest from January take a lot longer to produce the arrest than crimes in December. However, those January crimes have 15 months to produce an arrest (January 2023 to March 15, 2024) while the December arrests have only three months to produce an arrest before NIBRS reporting closes for the year. The observed pattern is entirely an artifact of the NIBRS data collection indicating that calculating clearance rates or time to clearance requires more care.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nibrsArr06 <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(ORI, INCIDENT.NUMBER) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">dateFirstArrest =</span> <span class="fu">min</span>(ARREST.DATE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(nibrsCrm02 <span class="sc">|&gt;</span> </span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(ORI, INCIDENT.NUMBER, INCIDENT.DATE) <span class="sc">|&gt;</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">distinct</span>(),</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">timeToArrest =</span> <span class="fu">difftime</span>(dateFirstArrest, INCIDENT.DATE, </span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">units=</span><span class="st">"days"</span>) ,</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">INCIDENT.MONTH =</span> <span class="fu">month</span>(INCIDENT.DATE, <span class="at">label=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(INCIDENT.MONTH) <span class="sc">|&gt;</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(timeToArrest, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">max=</span><span class="fu">max</span>(timeToArrest,  <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   INCIDENT.MONTH mean           max     
   &lt;ord&gt;          &lt;drtn&gt;         &lt;drtn&gt;  
 1 Jan            11.864666 days 451 days
 2 Feb             9.946931 days 423 days
 3 Mar             9.304757 days 398 days
 4 Apr             8.638813 days 361 days
 5 May             8.325869 days 332 days
 6 Jun             7.769507 days 305 days
 7 Jul             7.028547 days 275 days
 8 Aug             6.381894 days 249 days
 9 Sep             5.575103 days 213 days
10 Oct             4.851006 days 185 days
11 Nov             3.846566 days 155 days
12 Dec             2.895208 days 125 days</code></pre>
</div>
</div>
<p>For a more fair comparison across months we can look at the percentage of crimes that result in an arrest within two months of the crime incident date. Technically, crimes on December 31st have until March 15th to have any arrests recorded (75 days), but I am going to set the threshold to within 60 days just in case it takes a few days for arrests in February for December crimes to get posted to NIBRS. Here we see that the percentage of crimes cleared with an arrest within 60 days is nearly constant across month of the year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ORI, INCIDENT.NUMBER, INCIDENT.DATE) <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(nibrsArr06 <span class="sc">|&gt;</span> </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(ORI, INCIDENT.NUMBER, ARREST.DATE) <span class="sc">|&gt;</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">dateFirstArrest =</span> <span class="fu">min</span>(ARREST.DATE, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">.groups =</span> <span class="st">"drop"</span>),</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">timeToArrest =</span> <span class="fu">difftime</span>(dateFirstArrest, INCIDENT.DATE, </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">units=</span><span class="st">"days"</span>),</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">arrest2Months =</span> <span class="fu">as.numeric</span>(<span class="sc">!</span><span class="fu">is.na</span>(timeToArrest) <span class="sc">&amp;</span> timeToArrest <span class="sc">&lt;=</span> <span class="dv">60</span>),</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">INCIDENT.MONTH =</span> <span class="fu">month</span>(INCIDENT.DATE, <span class="at">label=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(INCIDENT.MONTH) <span class="sc">|&gt;</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(arrest2Months, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="at">width=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   INCIDENT.MONTH  mean
   &lt;ord&gt;          &lt;dbl&gt;
 1 Jan            0.234
 2 Feb            0.238
 3 Mar            0.239
 4 Apr            0.239
 5 May            0.235
 6 Jun            0.232
 7 Jul            0.233
 8 Aug            0.235
 9 Sep            0.238
10 Oct            0.233
11 Nov            0.240
12 Dec            0.241</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises-1" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Exercises</h1>
<ol start="3" type="1">
<li><p>How many offenses are shootings? That is, the offense was aggravated assault (13A), and the offense was completed (C), and the weapon involved was a firearm (11, 12, 13, 14, 15).</p></li>
<li><p>What is the race distribution of shooting victims?</p></li>
<li><p>How many cases are recorded as justifiable homicides? Note the special codes in the NIBRS documentation file.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">20</td>
<td style="text-align: left;">Criminal killed by private citizen</td>
</tr>
<tr class="even">
<td style="text-align: left;">21</td>
<td style="text-align: left;">Criminal killed by police officer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">Criminal attacked police officer and that officer killed criminal</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: left;">Criminal attacked fellow police officer and criminal killed by another police officer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Criminal attacked a civilian</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: left;">Criminal attempted flight from a crime</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E</td>
<td style="text-align: left;">Criminal killed in commission of a crime</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: left;">Criminal resisted arrest</td>
</tr>
<tr class="odd">
<td style="text-align: left;">G</td>
<td style="text-align: left;">Unable to determine/not enough information</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>Other data sources show that the total number of fatal police shooting victims is about 1,000 per year.</p>
<ol start="6" type="1">
<li>This exercise will involve a lot more work, including acquiring NIBRS data from multiple years. First, listen to the story “<a href="https://www.marketplace.org/2023/09/11/is-retail-theft-really-rising/">Is retail theft really rising?</a>” featuring Kai Ryssdal and Livi Burdette recorded on September 11, 2023. In the discussion, one reporter seems to indicate that there are no national data on retail theft. Now that you have worked through this script and worked with NIBRS, you can see that retail theft is a UCR code reportable to NIBRS. Now some stores might not report retail theft to the police, but such non-reporting plagues all crime types. But you can evaluate whether reports of retail theft are increasing or decreasing over time. When examining trends over the last several years, make sure to consider that some agencies, like NYPD, just started reporting in 2023. Best to exclude them if you wish to compare trends from 2021 to the present. So, do the NIBRS data indicate that retail theft is rising?</li>
</ol>
</section>
<section id="answers-to-the-exercises" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Answers to the exercises</h1>
<ol type="1">
<li>How many Group A offenses were reported to the Philadelphia Police Department (ORI PAPEP0000)?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span> <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"PAPEP0000"</span>) <span class="sc">|&gt;</span> <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
       n
   &lt;int&gt;
1 170168</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>What is the most commonly reported crime in Philadelphia? Use the OffenseLookup to replace the UCR codes with crime descriptions.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(ORI<span class="sc">==</span><span class="st">"PAPEP0000"</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(UCR.OFFENSE.CODE) <span class="sc">|&gt;</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_max</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(OffenseLookup, </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">by=</span><span class="fu">join_by</span>(UCR.OFFENSE.CODE<span class="sc">==</span>UCRCode)) <span class="sc">|&gt;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(n, Crime)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
      n Crime                                   
  &lt;int&gt; &lt;chr&gt;                                   
1 31068 Destruction/Damage/Vandalism of Property</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>How many offenses are shootings?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="sc">==</span><span class="st">"13A"</span> <span class="sc">&amp;</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>           OFFENSE.ATTEMPTED.COMPLETED<span class="sc">==</span><span class="st">"C"</span> <span class="sc">&amp;</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>           (WEAPON.FORCE<span class="fl">.1</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>            WEAPON.FORCE<span class="fl">.2</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>            WEAPON.FORCE<span class="fl">.3</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)) <span class="sc">|&gt;</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
       n
   &lt;int&gt;
1 181371</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>What is the race distribution of shooting victims?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="sc">==</span><span class="st">"13A"</span> <span class="sc">&amp;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>         OFFENSE.ATTEMPTED.COMPLETED<span class="sc">==</span><span class="st">"C"</span> <span class="sc">&amp;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>         (WEAPON.FORCE<span class="fl">.1</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>          WEAPON.FORCE<span class="fl">.2</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>          WEAPON.FORCE<span class="fl">.3</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)) <span class="sc">|&gt;</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nibrsVic04,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RACE.OF.VICTIM, ETHNICITY.OF.VICTIM) <span class="sc">|&gt;</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()  <span class="sc">|&gt;</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ETHNICITY.OF.VICTIM,</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n,</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 5
# Groups:   RACE.OF.VICTIM [7]
  RACE.OF.VICTIM     H      N     U  `NA`
  &lt;chr&gt;          &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
1 A                165   2657   306   261
2 B               1227 112878 11398 19727
3 I                128   1726   271   434
4 P                140    351    63    28
5 U               2530   1456  5639  2046
6 W              46833  57513  7952 13205
7 &lt;NA&gt;               0      0     0 30829</code></pre>
</div>
</div>
<p>Here’s a little more complete version that makes sure the victim in the incident is one of the shooting victims and tabulates Hispanic as a race category. Some offenses might involve an offender hitting one person and shooting another. This code makes sure we just count the race of those actually shot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="sc">==</span><span class="st">"13A"</span> <span class="sc">&amp;</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         OFFENSE.ATTEMPTED.COMPLETED<span class="sc">==</span><span class="st">"C"</span> <span class="sc">&amp;</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>           (WEAPON.FORCE<span class="fl">.1</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>            WEAPON.FORCE<span class="fl">.2</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">|</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>            WEAPON.FORCE<span class="fl">.3</span> <span class="sc">%in%</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">15</span>)) <span class="sc">|&gt;</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ORI, INCIDENT.NUMBER) <span class="sc">|&gt;</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(nibrsVic04 <span class="sc">|&gt;</span> </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="fl">.1</span><span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> UCR.OFFENSE.CODE<span class="fl">.2</span> <span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>                     UCR.OFFENSE.CODE<span class="fl">.3</span><span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> UCR.OFFENSE.CODE<span class="fl">.4</span> <span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>                     UCR.OFFENSE.CODE<span class="fl">.5</span><span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> UCR.OFFENSE.CODE<span class="fl">.6</span> <span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> </span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>                     UCR.OFFENSE.CODE<span class="fl">.7</span><span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> UCR.OFFENSE.CODE<span class="fl">.8</span> <span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> </span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>                     UCR.OFFENSE.CODE<span class="fl">.9</span><span class="sc">==</span><span class="st">"13A"</span> <span class="sc">|</span> UCR.OFFENSE.CODE<span class="fl">.10</span><span class="sc">==</span><span class="st">"13A"</span>) <span class="sc">|&gt;</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">select</span>(ORI,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>                     INCIDENT.NUMBER,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>                     RACE.OF.VICTIM,</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>                     ETHNICITY.OF.VICTIM),</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span><span class="fu">join_by</span>(ORI, INCIDENT.NUMBER)) <span class="sc">|&gt;</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">race2=</span><span class="fu">case_when</span>(ETHNICITY.OF.VICTIM<span class="sc">==</span><span class="st">"H"</span> <span class="sc">~</span> <span class="st">"H"</span>,</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">.default=</span>RACE.OF.VICTIM)) <span class="sc">|&gt;</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race2) <span class="sc">|&gt;</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
# Groups:   race2 [7]
  race2      n
  &lt;chr&gt;  &lt;int&gt;
1 A       2904
2 B     134553
3 H      47925
4 I       2271
5 P        412
6 U       7833
7 W      73097</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>How many cases are recorded as justifiable homicides?</li>
</ol>
<p>Here’s the first idea. We can count “criminal” incidents involving UCR code 09C, justifiable homicide.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>nibrsCrm02 <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(UCR.OFFENSE.CODE<span class="sc">==</span><span class="st">"09C"</span>) <span class="sc">|&gt;</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1   671</code></pre>
</div>
</div>
<p>A second approach is to count victims, those killed by citizens (circumstance 20) and those killed by police (circumstance 21).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(nibrsVic04<span class="sc">$</span>CIRCUMSTANCE<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    01     02     03     04     05     06     07     08     09     10     20 
294313  22595   2136   3066   1905  99067     16   9620 143124 184583    443 
    21     30     31     32     33     34 
   248     38     10      2    298   1670 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(nibrsVic04<span class="sc">$</span>CIRCUMSTANCE<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  02   03   04   05   06   08   09 
 124  135  107  121 8209 1001 4629 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(nibrsVic04<span class="sc">$</span>CIRCUMSTANCE<span class="fl">.1</span> <span class="sc">%in%</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 691</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(nibrsVic04<span class="sc">$</span>ADDITIONAL.JUSTIFIABLE.HOMICIDE.CIRCUMSTANCES)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  A   B   C   D   E   F   G 
133  37 302   4 178  13  24 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Code</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">20</td>
<td style="text-align: left;">Criminal killed by private citizen</td>
</tr>
<tr class="even">
<td style="text-align: left;">21</td>
<td style="text-align: left;">Criminal killed by police officer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">Criminal attacked police officer and that officer killed criminal</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: left;">Criminal attacked fellow police officer and criminal killed by another police officer</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">Criminal attacked a civilian</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: left;">Criminal attempted flight from a crime</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E</td>
<td style="text-align: left;">Criminal killed in commission of a crime</td>
</tr>
<tr class="even">
<td style="text-align: left;">F</td>
<td style="text-align: left;">Criminal resisted arrest</td>
</tr>
<tr class="odd">
<td style="text-align: left;">G</td>
<td style="text-align: left;">Unable to determine/not enough information</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>The following code offers a more complete description of who committed the justifiable homicide and the reason for the homicide.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>nibrsVic04 <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CIRCUMSTANCE<span class="fl">.1</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"20"</span>,<span class="st">"21"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(CIRCUMSTANCE<span class="fl">.1</span>, ADDITIONAL.JUSTIFIABLE.HOMICIDE.CIRCUMSTANCES) <span class="sc">|&gt;</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> ADDITIONAL.JUSTIFIABLE.HOMICIDE.CIRCUMSTANCES,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> n,</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="co"># what to fill in for NAs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 8
# Groups:   CIRCUMSTANCE.1 [2]
  CIRCUMSTANCE.1     B     C     D     E     G     A     F
  &lt;chr&gt;          &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1 20                 1   276     1   150    15     0     0
2 21                36    26     3    28     9   133    13</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>