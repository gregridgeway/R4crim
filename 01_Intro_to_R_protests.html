<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Greg Ridgeway">
<meta name="dcterms.date" content="2025-08-22">

<title>Introduction to R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="01_Intro_to_R_protests_files/libs/clipboard/clipboard.min.js"></script>
<script src="01_Intro_to_R_protests_files/libs/quarto-html/quarto.js"></script>
<script src="01_Intro_to_R_protests_files/libs/quarto-html/popper.min.js"></script>
<script src="01_Intro_to_R_protests_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="01_Intro_to_R_protests_files/libs/quarto-html/anchor.min.js"></script>
<link href="01_Intro_to_R_protests_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="01_Intro_to_R_protests_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="01_Intro_to_R_protests_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="01_Intro_to_R_protests_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="01_Intro_to_R_protests_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="01_Intro_to_R_protests_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="01_Intro_to_R_protests_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="01_Intro_to_R_protests_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="01_Intro_to_R_protests_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="01_Intro_to_R_protests_files/libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet">

<script src="01_Intro_to_R_protests_files/libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>

<script src="01_Intro_to_R_protests_files/libs/wordcloud2-0.0.1/hover.js"></script>

<script src="01_Intro_to_R_protests_files/libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>



</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#basic-math-and-functions-in-r" id="toc-basic-math-and-functions-in-r" class="nav-link" data-scroll-target="#basic-math-and-functions-in-r"><span class="header-section-number">2</span> Basic Math and Functions in R</a></li>
  <li><a href="#combining-values-together-into-a-collection-or-vector" id="toc-combining-values-together-into-a-collection-or-vector" class="nav-link" data-scroll-target="#combining-values-together-into-a-collection-or-vector"><span class="header-section-number">3</span> Combining values together into a collection (or vector)</a></li>
  <li><a href="#setting-the-working-directory" id="toc-setting-the-working-directory" class="nav-link" data-scroll-target="#setting-the-working-directory"><span class="header-section-number">4</span> Setting the working directory</a></li>
  <li><a href="#loading-a-first-dataset-protests-in-the-united-states" id="toc-loading-a-first-dataset-protests-in-the-united-states" class="nav-link" data-scroll-target="#loading-a-first-dataset-protests-in-the-united-states"><span class="header-section-number">5</span> Loading a first dataset, protests in the United States</a>
  <ul class="collapse">
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">5.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#filtering-rows" id="toc-filtering-rows" class="nav-link" data-scroll-target="#filtering-rows"><span class="header-section-number">6</span> Filtering rows</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise"><span class="header-section-number">6.1</span> Exercise</a></li>
  </ul></li>
  <li><a href="#summarizing-data" id="toc-summarizing-data" class="nav-link" data-scroll-target="#summarizing-data"><span class="header-section-number">7</span> Summarizing data</a></li>
  <li><a href="#mutate-to-edit-and-create-new-columns" id="toc-mutate-to-edit-and-create-new-columns" class="nav-link" data-scroll-target="#mutate-to-edit-and-create-new-columns"><span class="header-section-number">8</span> Mutate to edit and create new columns</a>
  <ul class="collapse">
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1"><span class="header-section-number">8.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#creating-your-own-functions" id="toc-creating-your-own-functions" class="nav-link" data-scroll-target="#creating-your-own-functions"><span class="header-section-number">9</span> Creating your own functions</a></li>
  <li><a href="#summarizing-with-groups-of-protests" id="toc-summarizing-with-groups-of-protests" class="nav-link" data-scroll-target="#summarizing-with-groups-of-protests"><span class="header-section-number">10</span> Summarizing with groups of protests</a>
  <ul class="collapse">
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2"><span class="header-section-number">10.1</span> Exercises</a></li>
  </ul></li>
  <li><a href="#pivot_widerpivot_longer" id="toc-pivot_widerpivot_longer" class="nav-link" data-scroll-target="#pivot_widerpivot_longer"><span class="header-section-number">11</span> <code>pivot_wider()</code>/<code>pivot_longer()</code></a></li>
  <li><a href="#graphics-and-plots" id="toc-graphics-and-plots" class="nav-link" data-scroll-target="#graphics-and-plots"><span class="header-section-number">12</span> Graphics and plots</a></li>
  <li><a href="#review" id="toc-review" class="nav-link" data-scroll-target="#review"><span class="header-section-number">13</span> Review</a></li>
  <li><a href="#solutions-to-the-exercises" id="toc-solutions-to-the-exercises" class="nav-link" data-scroll-target="#solutions-to-the-exercises"><span class="header-section-number">14</span> Solutions to the exercises</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="01_Intro_to_R_protests.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to R</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Greg Ridgeway <a href="mailto:gridge@upenn.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Pennsylvania
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 22, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- In terminal -->
<!-- quarto render 01_Intro_to_R_protests.qmd -->
<!-- git commit 01-* -m "commit message" -->
<!-- git status -->
<!-- git push -->
<!-- A function for automating the numbering and wording of the exercise questions -->
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>This is the first set of notes for an introduction to R programming from criminology and criminal justice. These notes assume that you have the latest version of R and R Studio installed. We are also assuming that you know how to start a new script file and submit code to the R console. From that basic knowledge about using R, we are going to start with <code>2+2</code> and by the end of this set of notes you will load in a dataset on protests in the United States (mostly), create a few plots, count some incidents, and be able to do some basic data manipulations. Our aim is to build a firm foundation on which we will build throughout this set of notes.</p>
<p>R sometimes provides useful help as to how to do something, such as choosing the right function or figuring what the syntax of a line of code should be. Let’s say we’re stumped as to what the <code>sqrt()</code> function does. Just type <code>?sqrt</code> at the R prompt to read documentation on <code>sqrt()</code>. Most help pages have examples at the bottom that can give you a better idea about how the function works. R has over 7,000 functions and an often seemingly inconsistent syntax. As you do more complex work with R (such as using new packages), the Help tab can be useful.</p>
</section>
<section id="basic-math-and-functions-in-r" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Basic Math and Functions in R</h1>
<p>R, on a very unsophisticated level, is like a calculator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">+</span><span class="dv">2</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="dv">3</span><span class="sc">*</span><span class="dv">4</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3-4</span>)<span class="sc">/</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">7</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">2</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">+</span><span class="fu">sqrt</span>(<span class="dv">5</span>))<span class="sc">/</span><span class="dv">2</span> <span class="co"># golden ratio</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="sc">^</span><span class="dv">3</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="fl">2.718281828</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fl">2.718281828</span>,<span class="dv">3</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span><span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">factorial</span>(<span class="dv">4</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="sc">-</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4
[1] 24
[1] 0.05714286
[1] 1.414214
[1] 1.618034
[1] 8
[1] 1
[1] 2.718
[1] 144
[1] 24
[1] 4</code></pre>
</div>
</div>
</section>
<section id="combining-values-together-into-a-collection-or-vector" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Combining values together into a collection (or vector)</h1>
<p>We will use the <code>c()</code> function a lot. <code>c()</code> <em>c</em>ombines elements, like numbers and text to form a vector or a collection of values. If we wanted to combine the numbers 1 to 5 we could do</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<p>With the <code>c()</code> function, it’s important to separate all of the items with commas.</p>
<p>Conveniently, if you want to add 1 to each item in this collection, there’s no need to add 1 like <code>c(1+1,2+1,3+1,4+1,5+1)</code>… that’s a lot of typing. Instead R offers the shortcut</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)<span class="sc">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 3 4 5 6</code></pre>
</div>
</div>
<p>In fact, you can apply any mathematical operation to each value in the same way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)<span class="sc">-</span><span class="dv">3</span>)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="sc">-</span><span class="dv">3</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  4  6  8 10
[1] 1.000000 1.414214 1.732051 2.000000 2.236068
[1] 4 1 0 1 4
[1] 1 1 2 2 3 3</code></pre>
</div>
</div>
<p>Note in the examples below that you can also have a collection of non-numerical items. When combining text items, remember to use quotes around each item.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"CRIM6000"</span>,<span class="st">"CRIM6001"</span>,<span class="st">"CRIM6002"</span>,<span class="st">"CRIM6003"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"yes"</span>,<span class="st">"no"</span>,<span class="st">"no"</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="st">"yes"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CRIM6000" "CRIM6001" "CRIM6002" "CRIM6003"
[1] "yes" "no"  "no"  NA    NA    "yes"</code></pre>
</div>
</div>
<p>In R, <code>NA</code> means a missing value. We’ll do more exercises later using data containing some <code>NA</code> values. In any dataset in the wild, you are virtually guaranteed to find some <code>NA</code>s. The function <code>is.na()</code> helps determine whether there are any missing values (any NAs). In some of the problems below, we will use <code>is.na()</code>.</p>
<p>You can use double quotes or single quotes in R as long as you are consistent. When you have quotes inside the text you need to be particularly careful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Lou Gehrig's disease"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="st">'The officer shouted "halt!"'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Lou Gehrig's disease"
[1] "The officer shouted \"halt!\""</code></pre>
</div>
</div>
<p>The backslashes in the above text “protect” the double quote, communicating to you and to R that the next double quote is not the end of the text, but a character that is actually part of the text you want to keep.</p>
<p>The <code>c()</code> function is not the only way to make a collection of values in R. For example, placing a <code>:</code> between two numbers can return a collection of numbers in sequence. The functions <code>rep()</code> and <code>seq()</code> produce repeated values or sequences.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="sc">:-</span><span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  5  4  3  2  1  0 -1 -2 -3 -4 -5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">each=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 1 1 1 1 2 2 2 2 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 5</code></pre>
</div>
</div>
<p>R will also do arithmetic with two vectors, doing the calculation pairwise. The following will compute 1+11 and 2+12 up to 10+20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">+</span> <span class="dv">11</span><span class="sc">:</span><span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 12 14 16 18 20 22 24 26 28 30</code></pre>
</div>
</div>
<p>Yet, other functions operate on the whole collection of values in a vector. See the following examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># sum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 55</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># how many?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># cumulative sum</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1 11 14 20 22 27 35 39 46 55</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># mean of collection of 10 numbers</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># median of same population</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
</div>
<p>There are also some functions in R that help us find the biggest and smallest values. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># what is the biggest value in vector?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># in which "spot" would we find it?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># what is the smallest value in vector?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)) <span class="co"># in which "spot" would we find it?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
</section>
<section id="setting-the-working-directory" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Setting the working directory</h1>
<p>Now that we have covered a lot of fundamental R features, it is time to load in a real dataset. However, before we do that, R needs to know where to find the data file. So we first need to talk about “the working directory”. When you start R, it has a default folder or directory on your computer where it will retrieve or save any files. You can run <code>getwd()</code> to get the current working directory. Here’s our current working directory, which will not be the same as yours.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "C:/R4crim"</code></pre>
</div>
</div>
<p>Almost certainly this default directory is <em>not</em> where you plan to have all of your datasets and files stored. Instead, you probably have an “analysis” or “project” or “R4crim” folder somewhere on your computer where you would like to store your data and work.</p>
<p>Use <code>setwd()</code> to tell R what folder you want it to use as the working directory. If you do not set the working directory, R will not know where to find the data you wish to import and will save your results in a location in which you would probably never look. Make it a habit to have <code>setwd()</code> as the first line of every script you write. If you know the working directory you want to use, then you can just put it inside the <code>setwd()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/greg_/CRIM6002/notes/R4crim"</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that for all platforms, Windows, Macs, and Linux, the working directory only uses forward slashes. So Windows users be careful… most Windows applications use backslashes, but in an effort to make R scripts work across all platforms, R requires forward slashes. Backslashes have a different use in R that you will meet later.</p>
<p>If you do not know how to write your working directory, here comes R Studio to the rescue. In R Studio click Session -&gt; Set Working Directory -&gt; Choose Directory. Then click through to navigate to the working directory that you want to use. When you find it click “Select Folder”. Then look over at the console. R Studio will construct the right <code>setwd()</code> syntax for you. Copy and paste that into your script for use later. No need to have to click through the Session menu again now that you have your <code>setwd()</code> set up.</p>
<p>Now you can use R functions to load in any datasets that are in your working folder. If you have done your <code>setwd()</code> correctly, you shouldn’t get any errors because R will know exactly where to look for the data files. If the working directory that you’ve given in the <code>setwd()</code> isn’t right, R will think the file doesn’t even exist. For example, if you give the path for, say, your R4econ folder, R won’t be able to load data because the file isn’t stored in what R thinks is your working directory. With that out of the way, let’s load a dataset.</p>
</section>
<section id="loading-a-first-dataset-protests-in-the-united-states" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Loading a first dataset, protests in the United States</h1>
<p>We are going to use a dataset of protests in the United States. The data comes from <a href="https://countlove.org/faq.html">CountLove</a>. The data is a collection of protests that occurred in the United States from 2017 through January 2021. The data includes the date of the protest, the location, the number of attendees, and the reason for the protest. We will load the data and explore it. They stopped collection in February 2021, but you can find more recent crowd data at the <a href="https://ash.harvard.edu/programs/crowd-counting-consortium/">Crowd Counting Consortium</a>.</p>
<p>We start by loading in the dataset. I have created a .RData file containing the protest data. This is stored in a special format that R can read quickly. The file is called <code>protests.RData</code>. We will load this file into R using the <code>load()</code> function. Once we have loaded the data, we can see what is in the dataset using the <code>ls()</code> function. This will list all the objects in the current environment. If you have just started using R, most likely the only object you see in your environment is <code>dataProtest</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"protests.RData"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dataProtest"</code></pre>
</div>
</div>
<p>To start exploring the protest data, have a look at how many rows (protests) and how many columns (protest features) are in the dataset. Then use the <code>head()</code> function to show the first few rows of the dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many rows?</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 38097</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many columns?</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
2 2017-01-16                  Johnson City, TN       300
3 2017-01-16                  Indianapolis, IN        20
4 2017-01-16                    Cincinnati, OH        NA
5 2017-01-18                      Hartford, CT       300
6 2017-01-19                    Washington, DC        NA
             Event..legacy..see.tags.
1                          Healthcare
2                        Civil Rights
3                         Environment
4      Other (Martin Luther King Jr.)
5 Healthcare (Pro-Planned Parenthood)
6                           Executive
                                                       Tags Curated
1                       Healthcare; For Affordable Care Act     Yes
2 Civil Rights; For racial justice; Martin Luther King, Jr.     Yes
3                  Environment; For wilderness preservation     Yes
4 Civil Rights; For racial justice; Martin Luther King, Jr.     Yes
5                        Healthcare; For Planned Parenthood     Yes
6                         Executive; Against 45th president     Yes
                                                                                                                                     Source
1                                                            http://www.capitalgazette.com/news/ph-ac-cn-aca-rally-0116-20170115-story.html
2 http://www.johnsoncitypress.com/Local/2017/01/16/Hundreds-march-to-honor-Martin-Luther-King-Jr-in-Johnson-City.html?ci=featured&amp;lp=46&amp;ti=
3                                             http://wishtv.com/2017/01/16/nature-groups-protest-deforestation-of-crown-hill-cemetery-land/
4                                          http://www.cincinnati.com/picture-gallery/news/2017/01/16/mlk-coalition-march-downtown/96636250/
5                                                                http://www.realhartford.org/2017/01/19/reproductive-freedom-day-of-action/
6                                                 https://malvern-online.com/content/melee-near-trumps-parade-route-police-protesters-clash
  Total.Articles
1              1
2              4
3              1
4              1
5              1
6              1</code></pre>
</div>
</div>
<p>We learn that the dataset has 38097 rows and 8 columns. The <code>head()</code> function shows the first few rows of the dataset. The first column is the date of the protest (<code>Date</code>), the second is the location (<code>Location</code>), and the third is the number of attendees (<code>Attendees</code>). The fifth column contains tags describing the purpose of the protest (<code>Tags</code>). The other columns contain other details, like links to news articles about the protest. We will not be using these other features.</p>
<p>Some R functionality relies on packages written by others. For certain basic data tasks, such as selecting certain columns, filtering rows, modifying values, and summarizing data, we will use the <code>dplyr</code> package (usually pronounced dee-ply-er… intended to evoke pliers for data). If you do not have <code>dplyr</code> installed, you can install it by running <code>install.packages("dplyr")</code>. This is a one-time installation. Once per R session, you need to load the package using <code>library()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now with <code>dplyr</code> loaded we can slice the protest data to just pick our certain rows, like the first row.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slice</span>(dataProtest, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
  Event..legacy..see.tags.                                Tags Curated
1               Healthcare Healthcare; For Affordable Care Act     Yes
                                                                          Source
1 http://www.capitalgazette.com/news/ph-ac-cn-aca-rally-0116-20170115-story.html
  Total.Articles
1              1</code></pre>
</div>
</div>
<p>There is a more modern “grammar” in R using the pipe operator. This is a way to chain together functions in a more readable way. The pipe operator is <code>|&gt;</code>. It takes the output of the function on the left and passes it as the first argument to the function on the right. Here is the same code as above using the pipe operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
  Event..legacy..see.tags.                                Tags Curated
1               Healthcare Healthcare; For Affordable Care Act     Yes
                                                                          Source
1 http://www.capitalgazette.com/news/ph-ac-cn-aca-rally-0116-20170115-story.html
  Total.Articles
1              1</code></pre>
</div>
</div>
<p>This code takes <code>dataProtest</code> and passes it in to the first argument of the <code>slice()</code> function. The <code>slice()</code> function then returns the first row of the dataset. The code is more readable this way.</p>
<p>You will also see many users using <code>%&gt;%</code> in their code. The <code>%&gt;%</code> pipe operator has been around longer, but the newer <code>|&gt;</code> pipe operator, created in 2021 for R 4.1.0, is <a href="https://michaelbarrowman.co.uk/post/the-new-base-pipe/">faster</a>. You can use either one.</p>
<p>If you want the first 3 rows you can also use <code>slice()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
2 2017-01-16                  Johnson City, TN       300
3 2017-01-16                  Indianapolis, IN        20
  Event..legacy..see.tags.
1               Healthcare
2             Civil Rights
3              Environment
                                                       Tags Curated
1                       Healthcare; For Affordable Care Act     Yes
2 Civil Rights; For racial justice; Martin Luther King, Jr.     Yes
3                  Environment; For wilderness preservation     Yes
                                                                                                                                     Source
1                                                            http://www.capitalgazette.com/news/ph-ac-cn-aca-rally-0116-20170115-story.html
2 http://www.johnsoncitypress.com/Local/2017/01/16/Hundreds-march-to-honor-Martin-Luther-King-Jr-in-Johnson-City.html?ci=featured&amp;lp=46&amp;ti=
3                                             http://wishtv.com/2017/01/16/nature-groups-protest-deforestation-of-crown-hill-cemetery-land/
  Total.Articles
1              1
2              4
3              1</code></pre>
</div>
</div>
<p>or you can use <code>head()</code> that we used earlier.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
2 2017-01-16                  Johnson City, TN       300
3 2017-01-16                  Indianapolis, IN        20
  Event..legacy..see.tags.
1               Healthcare
2             Civil Rights
3              Environment
                                                       Tags Curated
1                       Healthcare; For Affordable Care Act     Yes
2 Civil Rights; For racial justice; Martin Luther King, Jr.     Yes
3                  Environment; For wilderness preservation     Yes
                                                                                                                                     Source
1                                                            http://www.capitalgazette.com/news/ph-ac-cn-aca-rally-0116-20170115-story.html
2 http://www.johnsoncitypress.com/Local/2017/01/16/Hundreds-march-to-honor-Martin-Luther-King-Jr-in-Johnson-City.html?ci=featured&amp;lp=46&amp;ti=
3                                             http://wishtv.com/2017/01/16/nature-groups-protest-deforestation-of-crown-hill-cemetery-land/
  Total.Articles
1              1
2              4
3              1</code></pre>
</div>
</div>
<p>I have the general habit of running <code>head()</code> and <code>tail()</code> on any datasets I am working with just to make sure it looks like what I expect. I encourage you to do the same. Many errors can be avoided by just looking at the data.</p>
<p>We may also be interested in only a few columns of the dataset. We can use the <code>select()</code> function to pick out the columns we want. For example, if we only want the date and location of the protest, we can use the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span> </span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Date, Location) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location
1 2017-01-15 Bowie State University, Bowie, MD
2 2017-01-16                  Johnson City, TN
3 2017-01-16                  Indianapolis, IN</code></pre>
</div>
</div>
<p>This code takes <code>dataProtest</code> and passes it to the <code>select()</code> function. The <code>select()</code> function then returns only the <code>Date</code> and <code>Location</code> columns of the dataset. <code>head(3)</code> then returns the first 3 rows of the dataset. Here you can see how the pipe operator can be used to chain together functions in a readable way. Technically, this code is identical to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">select</span>(dataProtest, Date, Location), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location
1 2017-01-15 Bowie State University, Bowie, MD
2 2017-01-16                  Johnson City, TN
3 2017-01-16                  Indianapolis, IN</code></pre>
</div>
</div>
<p>The computer does not care which approach you take. However, the potential problem with this code is that there is so much distance between <code>head</code> and the <code>3</code> at the end. This distance makes it harder to read, understand, and find errors. It will become even more important when we chain many more functions together.</p>
<p>You can also get a column by name using the <code>$</code> operator. For example, to get the <code>Date</code> column you can use <code>dataProtest$Date</code>. To get the first 10 dates you can use <code>dataProtest$Date[1:10]</code>. To get the first 10 locations you can use <code>dataProtest$Location[1:10]</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Date[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2017-01-15" "2017-01-16" "2017-01-16" "2017-01-16" "2017-01-18"
 [6] "2017-01-19" "2017-01-19" "2017-01-20" "2017-01-20" "2017-01-20"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Location[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bowie State University, Bowie, MD"    
 [2] "Johnson City, TN"                     
 [3] "Indianapolis, IN"                     
 [4] "Cincinnati, OH"                       
 [5] "Hartford, CT"                         
 [6] "Washington, DC"                       
 [7] "Washington, DC"                       
 [8] "University of Washington, Seattle, WA"
 [9] "Westlake Park, Seattle, WA"           
[10] "Columbus, OH"                         </code></pre>
</div>
</div>
<p>So far every time we run some R code the results are dumped to the console. This is R’s default behavior. If you do not indicate otherwise, it will dump the results to the console and promptly forget those results. When we want to store the results, we can use the assignment operator <code>&lt;-</code>. For example, to save the first 10 dates to a variable <code>a</code> you can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> dataProtest<span class="sc">$</span>Date[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To save the first 10 locations to a variable <code>b</code> you can use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> dataProtest<span class="sc">$</span>Location[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now if we run <code>ls()</code> we will see that we have two new variables <code>a</code> and <code>b</code> in our environment. We can use these variables later in our code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a"           "b"           "dataProtest"</code></pre>
</div>
</div>
<p>If you want to see the contents of a variable you can just type the variable name and run the code. For example, to see the contents of <code>a</code> you can run</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "2017-01-15" "2017-01-16" "2017-01-16" "2017-01-16" "2017-01-18"
 [6] "2017-01-19" "2017-01-19" "2017-01-20" "2017-01-20" "2017-01-20"</code></pre>
</div>
</div>
<p>If a line of R code does not have a <code>&lt;-</code>, then the results will not be stored. I would like to simplify our protest dataset by removing some columns that we will not use. I will use the <code>select()</code> function to pick out the columns to keep <em>and</em> use the <code>&lt;-</code> operator to replace the original <code>dataProtest</code> with a new version of <code>dataProtest</code> that only has the columns I want.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Date, Location, Attendees, Tags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now if you run <code>head(dataProtest)</code> you will see that the dataset only has the <code>Date</code>, <code>Location</code>, <code>Attendees</code>, and <code>Tags</code> columns. The other columns have been removed. <code>select()</code> also allows you to indicate which features to drop by prefixing their names with a minus sign. Instead of listing the features we wanted to keep, we could have listed the features we wanted to drop, using <code>select(-Event..legacy..see.tags., -Source, -Curated, -Total.Articles)</code>.</p>
<section id="exercises" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="exercises"><span class="header-section-number">5.1</span> Exercises</h2>
<ol type="1">
<li>What is the date of the protest in line 10000 of the dataset?</li>
<li>Which protest type is in line 4289 of the dataset?</li>
</ol>
</section>
</section>
<section id="filtering-rows" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Filtering rows</h1>
<p>We can ask every location if they equal “Philadelphia, PA”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's just ask the first 10, otherwise will print out the first 1,000 </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Location[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]<span class="sc">==</span><span class="st">"Philadelphia, PA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
</div>
</div>
<p>Note the use of the double equal sign <code>==</code>. This is the “logical” equal. It is not making <code>Location</code> equal to Philadelphia, PA. It is asking if <code>Location</code> is equal to Philadelphia, PA. The result is a vector of <code>TRUE</code> and <code>FALSE</code> values. If the location is Philadelphia, PA, then the result is <code>TRUE</code>. If the location is not Philadelphia, PA, then the result is <code>FALSE</code>.</p>
<p>How many protests occurred in Philadelphia, PA?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"Philadelphia, PA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 193</code></pre>
</div>
</div>
<p>The <code>filter()</code> function is used to select rows that meet a certain condition. In this case, we are selecting rows where the <code>Location</code> is equal to “Philadelphia, PA”. The expression <code>Location=="Philadelphia, PA"</code> will evaluate to <code>TRUE</code> for any row where <code>Location</code> is identical to “Philadelphia, PA” and <code>FALSE</code> otherwise. <code>filter()</code> will keep only those rows where the logical expression evaluates to <code>TRUE</code> eliminating all others (<code>NA</code>s also get eliminated). The <code>nrow()</code> function, which we met earlier, is used to count the number of rows in the dataset. The result is the number of protests that occurred in Philadelphia, PA.</p>
<p>However, this count does not include those with locations like “University of Pennsylvania, Philadelphia, PA”. For example, these ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Location<span class="sc">==</span><span class="st">"University of Pennsylvania, Philadelphia, PA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                                     Location Attendees
1 2018-02-22 University of Pennsylvania, Philadelphia, PA       130
2 2019-04-23 University of Pennsylvania, Philadelphia, PA        10
3 2019-04-23 University of Pennsylvania, Philadelphia, PA        50
4 2019-10-23 University of Pennsylvania, Philadelphia, PA        NA
                                                                 Tags
1                                       Guns; For greater gun control
2                                           Other; For animal welfare
3                                   Other; Against closure/relocation
4 Immigration; For compassionate immigration; Against invited speaker</code></pre>
</div>
</div>
<p>The <code>Location</code> feature has the phrase “Philadelphia, PA”, but the <code>Location</code> is not <em>exactly</em> identical to “Philadelphia, PA”. It is time to introduce you to <code>grepl()</code>, which is a very powerful function for searching for patterns in text. For now, we will use it simply to search for any <code>Location</code> containing the phrase “Philadelphia, PA”. <code>grepl()</code> returns <code>TRUE</code> if the phrase is found and <code>FALSE</code> if it is not found. For example, to find all protests that occurred in Philadelphia, PA, we can use the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Philadelphia, PA"</span>, Location)) <span class="sc">|&gt;</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                                             Location Attendees
1 2017-01-21                                     Philadelphia, PA     50000
2 2017-01-26                                     Philadelphia, PA      2360
3 2017-01-29 Philadelphia International Airport, Philadelphia, PA      1910
4 2017-02-02                                     Philadelphia, PA       800
5 2017-02-04             Philadelphia City Hall, Philadelphia, PA      2000
                                             Tags
1 Civil Rights; For women's rights; Women's March
2               Executive; Against 45th president
3                 Immigration; Against travel ban
4                 Immigration; Against travel ban
5                 Immigration; Against travel ban</code></pre>
</div>
</div>
<p>Now we have found many more protests in Philadelphia since some of them were at the airport or at City Hall. Let’s redo that count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Philadelphia, PA"</span>, Location)) <span class="sc">|&gt;</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 327</code></pre>
</div>
</div>
<p>We will study <code>grepl()</code> and its variants a lot more later, but for now think of it as “Find” in your word processor. If you are looking for a word in a document, you can use “Find” to locate all instances of that word. <code>grepl()</code> is the same idea. It is looking for a phrase in a text field.</p>
<p>We can include multiple conditions in the <code>filter()</code> function. For example, to find all protests in Philadelphia, PA, before 2018 with more than 1,000 attendees, we can use the following code. Note that <code>&amp;</code> is the logical AND operator. It returns <code>TRUE</code> if both conditions are <code>TRUE</code> and <code>FALSE</code> otherwise. The <code>|</code> operator is the logical OR operator. It returns <code>TRUE</code> if either condition is <code>TRUE</code> and <code>FALSE</code> otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Philadelphia, PA"</span>, Location) <span class="sc">&amp;</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>           (Date <span class="sc">&lt;=</span> <span class="st">"2017-12-31"</span>) <span class="sc">&amp;</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>           (Attendees <span class="sc">&gt;=</span> <span class="dv">1000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Date                                             Location Attendees
1  2017-01-21                                     Philadelphia, PA     50000
2  2017-01-26                                     Philadelphia, PA      2360
3  2017-01-29 Philadelphia International Airport, Philadelphia, PA      1910
4  2017-02-04             Philadelphia City Hall, Philadelphia, PA      2000
5  2017-03-02                  Independence Mall, Philadelphia, PA      1000
6  2017-04-15                                     Philadelphia, PA      2000
7  2017-04-22                                     Philadelphia, PA     10000
8  2017-04-29                                     Philadelphia, PA      2000
9  2017-05-01                                     Philadelphia, PA      2000
10 2017-05-01                                     Philadelphia, PA      1000
11 2017-08-16                                     Philadelphia, PA      2000
                                                                         Tags
1                             Civil Rights; For women's rights; Women's March
2                                           Executive; Against 45th president
3                                             Immigration; Against travel ban
4                                             Immigration; Against travel ban
5                                       Civil Rights; For religious tolerance
6                              Executive; Against 45th president; Tax returns
7                                       Other; For science; March for Science
8                 Environment; Against climate change; People's Climate March
9      Immigration; For compassionate immigration; For worker rights; May Day
10                    Collective Bargaining; For better compensation; May Day
11 Civil Rights; For racial justice; Against white supremacy; Charlottesville</code></pre>
</div>
</div>
<section id="exercise" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="exercise"><span class="header-section-number">6.1</span> Exercise</h2>
<ol start="3" type="1">
<li><p>How many protests occurred in your home state? If not from the US just pick a state like New York “NY” or California “CA” or Pennsylvania “PA”</p></li>
<li><p>Where did the protest in the last row of the full dataset occur?</p></li>
</ol>
</section>
</section>
<section id="summarizing-data" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Summarizing data</h1>
<p>What is the average size of a protest? The <code>summarize()</code> function is used to calculate summary statistics. For example, to calculate the average number of attendees at a protest, we can use the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="fu">mean</span>(Attendees))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean(Attendees)
1              NA</code></pre>
</div>
</div>
<p>Hmmm… it looks like there are some missing values in the <code>Attendees</code> column. Rather than just dropping them and computing the average of the rest, R forces us to be intentional about handling <code>NA</code>s. If indeed we want to drop the <code>NA</code>s, then we can use the <code>na.rm=TRUE</code> argument to remove the missing values before calculating the average.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean(Attendees, na.rm = TRUE)
1                      643.8831</code></pre>
</div>
</div>
<p>Perhaps we are interested any several data summaries at the same time. No problem. Just include them all in <code>summarize()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">average =</span> <span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">median =</span> <span class="fu">median</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">minimum =</span> <span class="fu">min</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">maximum =</span> <span class="fu">max</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">NAcount =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Attendees)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   average median minimum maximum NAcount
1 643.8831    100       0  725000   15061</code></pre>
</div>
</div>
<p>That was a lot of typing to get a complete set of summary statistics. The <code>summary()</code> function is always available for that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dataProtest<span class="sc">$</span>Attendees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max.      NA's 
     0.00     26.75    100.00    643.88    200.00 725000.00     15061 </code></pre>
</div>
</div>
<p>You can also use it to get a quick summary of the entire dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Date             Location           Attendees             Tags          
 Length:38097       Length:38097       Min.   :     0.00   Length:38097      
 Class :character   Class :character   1st Qu.:    26.75   Class :character  
 Mode  :character   Mode  :character   Median :   100.00   Mode  :character  
                                       Mean   :   643.88                     
                                       3rd Qu.:   200.00                     
                                       Max.   :725000.00                     
                                       NA's   :15061                         </code></pre>
</div>
</div>
</section>
<section id="mutate-to-edit-and-create-new-columns" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Mutate to edit and create new columns</h1>
<p>The data does not contain a column for the state in which the protest occurred. We can create this column by extracting the state from the <code>Location</code> column. The last two characters of the <code>Location</code> column contain the state abbreviation. We can use the <code>str_sub()</code> function from the <code>stringr</code> package to extract the last two characters of the <code>Location</code> column. The <code>str_sub()</code> function is used to extract a substring from a string. For example, to extract the last two characters of the string “Philadelphia, PA”, we can use the following code. Let’s load the <code>stringr</code> and test out <code>str_sub()</code> on an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(<span class="st">"Philadelphia, PA"</span>, <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PA"</code></pre>
</div>
</div>
<p>The first argument is the string from which to extract the substring. The second argument is the starting position of the substring. A nice feature of <code>str_sub()</code> is that you can use negative numbers which it interprets as characters from the end. So the -2 tells <code>str_sub()</code> to start at the second to last character. The third argument is the ending position of the substring. Here the -1 means the very last character of the string. If we do not include a third argument, then <code>str_sub()</code> will extract the substring starting at the second argument and continuing to the end of the string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(<span class="st">"Philadelphia, PA"</span>, <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PA"</code></pre>
</div>
</div>
<p>There are other R functions that can extract substrings including <code>substring()</code>, <code>substr()</code>, and <code>gsub()</code>. I am introducing you to <code>str_sub()</code> since because it is the only one that lets you put negative numbers in the second and third arguments to easily grab substrings from the end. This is a very useful feature.</p>
<p>With <code>str_sub()</code> now in our toolbox, we can make a new column called <code>state</code> that contains the state in which the protest occurred.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_sub</span>(Location, <span class="sc">-</span><span class="dv">2</span>))</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
2 2017-01-16                  Johnson City, TN       300
3 2017-01-16                  Indianapolis, IN        20
4 2017-01-16                    Cincinnati, OH        NA
5 2017-01-18                      Hartford, CT       300
6 2017-01-19                    Washington, DC        NA
                                                       Tags state
1                       Healthcare; For Affordable Care Act    MD
2 Civil Rights; For racial justice; Martin Luther King, Jr.    TN
3                  Environment; For wilderness preservation    IN
4 Civil Rights; For racial justice; Martin Luther King, Jr.    OH
5                        Healthcare; For Planned Parenthood    CT
6                         Executive; Against 45th president    DC</code></pre>
</div>
</div>
<p>Peeking at the first few rows of <code>dataProtest</code> we can see that there is a new column with the state abbreviation. Please, always check that your code does what you intended to do. Run, check, run, check, one line at a time.</p>
<p>So you can see that <code>mutate()</code> is useful for making new data features computed based on other features. We also will use it to edit or clean up data. Let’s check what these state abbreviations look like.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   state    n
1     AK  252
2     AL  281
3     AR  174
4     AZ  563
5     CA 4439
6     CO  813
7     CT  708
8     DC  536
9     DE  115
10    FL 1822
11    Fl    1
12    GA  623
13    GU   22
14    HI  182
15    Hi    1
16    IA  470
17    ID  344
18    IL 1273
19    IN  700
20    KS  293
21    KY  821
22    LA  330
23    MA 1265
24    MD  453
25    ME  437
26    MI 1410
27    MN  747
28    MO  800
29    MS  187
30    MT  294
31    Mi    1
32    NC 1150
33    ND   98
34    NE  257
35    NH  266
36    NJ  893
37    NM  402
38    NV  300
39    NY 2688
40    OH 1107
41    OK  324
42    OR 1368
43    PA 1656
44    PR   19
45    RI  194
46    SC  439
47    SD  101
48    TN  576
49    TX 1649
50    UT  421
51    VA  906
52    VT  337
53    WA 1375
54    WI  812
55    WV  266
56    WY  131
57    ce    1
58    co    1
59    iD    1
60    te    1
61    wA    1</code></pre>
</div>
</div>
<p>Here I have used the <code>count()</code> function to count the number of protests in each state. It groups the data by the <code>state</code> column and then counts the number of rows in each group. The result is a new data frame with one column containing the state abbreviation (<code>state</code>) and another column containing the number of protests in that state (<code>count()</code> will always call this one <code>n</code>).</p>
<p>Do you see some problems with our state abbreviations? I see an “Fl”, an “Hi”, and an “Mi” and a few others that do not seem to be correctly capitalized. I also see some abbreviations that are “CE” and “TE”, not states that I know of. Let’s take a closer look at these strange ones. Note that I am introducing the <code>%in%</code> operator. This is a logical operator that asks each value of <code>state</code> whether its value is in the collection to the right of <code>%in%</code>. It is a more compact way to write <code>state=="Fl" | state=="Hi" | state=="Mi" | state=="ce" | state=="co" | state=="iD" | state=="te" | state=="wA"</code>. Well, there. I have gone ahead and typed that all out. I hope to never have to type a logical expression with so many ORs again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Fl"</span>,<span class="st">"Hi"</span>,<span class="st">"Mi"</span>,<span class="st">"ce"</span>,<span class="st">"co"</span>,<span class="st">"iD"</span>,<span class="st">"te"</span>,<span class="st">"wA"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(state, Location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state                                     Location
1    co                        Ciudad Juarez, Mexico
2    ce                                        Space
3    Fl                              Panama City, Fl
4    Mi Wyoming Godfrey-Lee High School, Wyoming, Mi
5    Hi                                 Honolulu, Hi
6    wA                                Montesano, wA
7    iD                     City Hall, Pocatello, iD
8    te       La Porte County Courthouse in La Porte</code></pre>
</div>
</div>
<p>Perhaps even more straightforward, R has a built in list of state abbreviations, <code>state.abb</code>. We can just filter those values of <code>state</code> that are not in this list (I will add Washington DC, Puerto Rico, and Guam too).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(state.abb, <span class="st">"DC"</span>, <span class="st">"PR"</span>, <span class="st">"GU"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(state, Location)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state                                     Location
1    co                        Ciudad Juarez, Mexico
2    ce                                        Space
3    Fl                              Panama City, Fl
4    Mi Wyoming Godfrey-Lee High School, Wyoming, Mi
5    Hi                                 Honolulu, Hi
6    wA                                Montesano, wA
7    iD                     City Hall, Pocatello, iD
8    te       La Porte County Courthouse in La Porte</code></pre>
</div>
</div>
<p>Lots of different kinds of errors here. Five of them are just lower case. One is in Mexico (we need to drop this one). One is in Space (space is cool so let’s keep that one for fun), and one is in La Porte, which I had to look up La Porte to find that it is in Indiana (IN). Let’s clean this up using <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(state <span class="sc">!=</span> <span class="st">"co"</span>) <span class="sc">|&gt;</span>  <span class="co"># drop Mexico</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">state =</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">case_match</span>(state,</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"ce"</span> <span class="sc">~</span> <span class="st">"Space"</span>,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"te"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.default =</span> <span class="fu">toupper</span>(state)))</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span> </span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   state    n
1     AK  252
2     AL  281
3     AR  174
4     AZ  563
5     CA 4439
6     CO  813
7     CT  708
8     DC  536
9     DE  115
10    FL 1823
11    GA  623
12    GU   22
13    HI  183
14    IA  470
15    ID  345
16    IL 1273
17    IN  701
18    KS  293
19    KY  821
20    LA  330
21    MA 1265
22    MD  453
23    ME  437
24    MI 1411
25    MN  747
26    MO  800
27    MS  187
28    MT  294
29    NC 1150
30    ND   98
31    NE  257
32    NH  266
33    NJ  893
34    NM  402
35    NV  300
36    NY 2688
37    OH 1107
38    OK  324
39    OR 1368
40    PA 1656
41    PR   19
42    RI  194
43    SC  439
44    SD  101
45 Space    1
46    TN  576
47    TX 1649
48    UT  421
49    VA  906
50    VT  337
51    WA 1376
52    WI  812
53    WV  266
54    WY  131</code></pre>
</div>
</div>
<p>Several things are happening here. First, we are using <code>case_match()</code> to change the state abbreviations. Note its structure. The first argument is the variable that we are matching (<code>state</code>). Then we list all the changes that we want to make. We are changing “ce” to “Space” and “te” to “IN”. The <code>.default</code> argument is used to keep all other state abbreviations the same. The <code>toupper()</code> function is used to make sure that all state abbreviations are in upper case. Finally we rerun the <code>count()</code> function to see if our changes worked. All looks good now.</p>
<p>The last feature that we have yet to explore is the <code>Tags</code> column. This column contains a list of reasons for the protest. The format of the tags is to have the reasons separated by a semicolon and a space. For example, a protest might have the tags “Civil Rights; Against pandemic intervention; Police brutality”. We can use the <code>strsplit()</code> function to split the tags into separate reasons. For example, to split the tags in the first three rows of the dataset, we can use the following code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># what does the tag look like originally?</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Tags[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Healthcare; For Affordable Care Act"                      
[2] "Civil Rights; For racial justice; Martin Luther King, Jr."
[3] "Environment; For wilderness preservation"                 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now split it</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(dataProtest<span class="sc">$</span>Tags[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="st">"; "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "Healthcare"              "For Affordable Care Act"

[[2]]
[1] "Civil Rights"            "For racial justice"     
[3] "Martin Luther King, Jr."

[[3]]
[1] "Environment"                 "For wilderness preservation"</code></pre>
</div>
</div>
<p><code>strsplit()</code> returns a <code>list</code> structure. This is a structure in R that has no columns and rows. Since each protest has a different number of tags, once we split them up, they do not fit neatly into fixed columns. We can use <code>unlist()</code> to remove the list structure and create a long vector of all of the tags. And I will use <code>table()</code>, <code>sort()</code>, and <code>tail()</code> to find the most common reasons for a protest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>reasons <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(dataProtest<span class="sc">$</span>Tags, <span class="st">"; "</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>reasons <span class="ot">&lt;-</span> <span class="fu">unlist</span>(reasons)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(reasons) <span class="sc">|&gt;</span> <span class="fu">sort</span>() <span class="sc">|&gt;</span> <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>reasons
               Immigration                      Other 
                      3543                       4556 
                    Police For greater accountability 
                      8254                       8376 
        For racial justice               Civil Rights 
                     10575                      14807 </code></pre>
</div>
</div>
<p>Clearly, Civil Rights has topped the list. We can use this information to create a new column that is 1 if the protest has the tag “Civil Rights” and 0 otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">civilrights =</span> <span class="fu">as.numeric</span>(<span class="fu">grepl</span>(<span class="st">"Civil Rights"</span>, Tags)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Just like before when we used <code>grepl()</code> to find any text matches for “Philadelphia, PA”, this time we are using it to search <code>Tags</code> for any matches to “Civil Rights”. Again, it returns <code>TRUE</code> if the pattern is found and <code>FALSE</code> otherwise. <code>as.numeric()</code> converts <code>TRUE</code> to 1 and <code>FALSE</code> to 0.</p>
<p>This script is getting long. I have done every step piece by piece with a lot of explanation in between. In practice, you would not do this. You would combine everything into one pipeline that takes in the original dataset and does all the filtering and mutating and selecting to get you the dataset that you want. Here is everything we have done so far compactly written.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"protests.RData"</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Date, Location, Attendees, Tags) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Location <span class="sc">!=</span> <span class="st">"Ciudad Juarez, Mexico"</span>) <span class="sc">|&gt;</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">state=</span><span class="fu">str_sub</span>(Location, <span class="sc">-</span><span class="dv">2</span>),</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">state=</span><span class="fu">case_match</span>(state,</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"ce"</span> <span class="sc">~</span> <span class="st">"Space"</span>,</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"te"</span> <span class="sc">~</span> <span class="st">"IN"</span>,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">.default =</span> <span class="fu">toupper</span>(state)),</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">civilrights=</span><span class="fu">as.numeric</span>(<span class="fu">grepl</span>(<span class="st">"Civil Rights"</span>, Tags)))</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataProtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date                          Location Attendees
1 2017-01-15 Bowie State University, Bowie, MD      1500
2 2017-01-16                  Johnson City, TN       300
3 2017-01-16                  Indianapolis, IN        20
4 2017-01-16                    Cincinnati, OH        NA
5 2017-01-18                      Hartford, CT       300
6 2017-01-19                    Washington, DC        NA
                                                       Tags state civilrights
1                       Healthcare; For Affordable Care Act    MD           0
2 Civil Rights; For racial justice; Martin Luther King, Jr.    TN           1
3                  Environment; For wilderness preservation    IN           0
4 Civil Rights; For racial justice; Martin Luther King, Jr.    OH           1
5                        Healthcare; For Planned Parenthood    CT           0
6                         Executive; Against 45th president    DC           0</code></pre>
</div>
</div>
<section id="exercises-1" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="exercises-1"><span class="header-section-number">8.1</span> Exercises</h2>
<ol start="5" type="1">
<li><p>Which state had the most protests?</p></li>
<li><p>Which state had the least protests?</p></li>
<li><p>Which state had the most civil rights protests?</p></li>
<li><p>Create a new column that is 1 if the protest has the tag ‘Against pandemic intervention’</p></li>
<li><p>Which state had the most protests against pandemic interventions?</p></li>
</ol>
</section>
</section>
<section id="creating-your-own-functions" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Creating your own functions</h1>
<p>Part of what makes R so powerful and useful is that you can create your own functions. In this way, the R user community can expand R’s capabilities to do new tasks. For example, R does not have a built-in function to find the most common value in a collection. We can create our own function to do this. Have a look at this sequence of steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">unlist</span>(reasons))</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
      Against 45th president       Against 46th president 
                        1543                            3 
     Against abortion rights          Against accusations 
                         444                            2 
Against administrative leave              Against advisor 
                           6                           12 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14807</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>a[a<span class="sc">==</span><span class="fu">max</span>(a)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Civil Rights 
       14807 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(a[a<span class="sc">==</span><span class="fu">max</span>(a)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Civil Rights"</code></pre>
</div>
</div>
<p>You have seen <code>table()</code> and <code>unlist()</code> in action earlier. Then I used <code>max()</code> to find the largest number of protests for a single reason. Then I used the expression <code>a[a==max(a)]</code>. Inside the square brackets, I ask each value of <code>a</code> (the table counts) if they equal the largest value. This returns a logical vector of <code>TRUE</code> and <code>FALSE</code> values. The square brackets will then pick out from a only those values where the logical expression <code>a==max(a)</code> evaluates to <code>TRUE</code>. I use this approach rather than <code>max()</code> or <code>head(1)</code> because it is possible that there are multiple tags that equal the maximum count. Finally, I used <code>names()</code> to get the name of the reason. I can pack all of this into a new function called <code>mostCommon()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>mostCommon <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>   a <span class="ot">&lt;-</span> <span class="fu">table</span>(x)  </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>( <span class="fu">names</span>(a[a<span class="sc">==</span><span class="fu">max</span>(a)]) )</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function is now a part of our R session and we can use it as we have other functions like <code>max()</code> or <code>mean()</code>. For example, to find the state with the most protests:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mostCommon</span>(dataProtest<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CA"</code></pre>
</div>
</div>
<p>Or the most common date for a protest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mostCommon</span>(dataProtest<span class="sc">$</span>Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2018-03-14"</code></pre>
</div>
</div>
<p>What the most common date for civil rights protests in Texas?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state<span class="sc">==</span><span class="st">"TX"</span> <span class="sc">&amp;</span> civilrights<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mostCommon</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mostCommon(Date)
1       2020-06-06</code></pre>
</div>
</div>
<p>What happened in Texas on 2020-06-06?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date<span class="sc">==</span><span class="st">"2020-06-06"</span> <span class="sc">&amp;</span> state<span class="sc">==</span><span class="st">"TX"</span>) <span class="sc">|&gt;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(Tags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                  Tags  n
1 Civil Rights; For racial justice; For greater accountability; Police 28
2                   Civil Rights; For white supremacy; Counter protest  1
3                                    Guns; Against greater gun control  1</code></pre>
</div>
</div>
<p>This is the height of the George Floyd protests. There were 28 protests recorded in Texas on that day tagged with “Civil Rights; For racial justice; For greater accountability; Police”.</p>
<p>Let’s make a special collection of states that includes PA and all of its bordering states. We can use this collection to filter the dataset to only include protests in these states.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>PAplusBorderingstates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PA"</span>,<span class="st">"DE"</span>,<span class="st">"MD"</span>,<span class="st">"NJ"</span>,<span class="st">"NY"</span>,<span class="st">"OH"</span>,<span class="st">"WV"</span>)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> PAplusBorderingstates) <span class="sc">|&gt;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mostCommon</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mostCommon(Date)
1       2018-03-14</code></pre>
</div>
</div>
<p>As I did earlier, I used the <code>%in%</code> operator to ask each state in <code>dataProtest</code> whether it is a member of the <code>PAplusBorderingstates</code> collection. This returns a logical vector of <code>TRUE</code> and <code>FALSE</code> values. The <code>filter()</code> function then keeps only those rows where the logical expression evaluates to <code>TRUE</code>.</p>
<p>Here we find that 2018-03-14 is the most common date for protests in Pennsylvania and its bordering states. This particular pi-Day was the day of the National School Walkout to protest gun violence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date<span class="sc">==</span><span class="st">"2018-03-14"</span> <span class="sc">&amp;</span> state <span class="sc">%in%</span> PAplusBorderingstates) <span class="sc">|&gt;</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(Tags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                  Tags   n
1                                  Civil Rights; For freedom of speech   1
2 Civil Rights; For racial justice; For greater accountability; Police   1
3                                    Environment; Against fossil fuels   1
4                   Guns; Against greater gun control; Counter protest   2
5                                        Guns; For greater gun control   2
6                  Guns; For greater gun control; National Walkout Day 262</code></pre>
</div>
</div>
</section>
<section id="summarizing-with-groups-of-protests" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Summarizing with groups of protests</h1>
<p>We can use the <code>group_by()</code> function to group the data by a certain feature. All subsequent operations will be performed separately within each group. For example, let’s total the number of protest attendees by state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># will double count protesters at multiple protests</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 2
   state `sum(Attendees, na.rm = TRUE)`
   &lt;chr&gt;                          &lt;int&gt;
 1 AK                             35987
 2 AL                             34919
 3 AR                             21859
 4 AZ                            224194
 5 CA                           3190858
 6 CO                            428654
 7 CT                            106285
 8 DC                           1460536
 9 DE                             11280
10 FL                            413328
11 GA                            177400
12 GU                               945
13 HI                             65548
14 IA                            101200
15 ID                             45776
16 IL                            907239
17 IN                             95985
18 KS                             45736
19 KY                            111992
20 LA                             45151
21 MA                            507235
22 MD                             70662
23 ME                             80716
24 MI                            214651
25 MN                            253084
26 MO                            130153
27 MS                             21677
28 MT                             66652
29 NC                            230558
30 ND                             13599
31 NE                             72351
32 NH                             45947
33 NJ                            166706
34 NM                             88496
35 NV                             95383
36 NY                           1730569
37 OH                            182713
38 OK                             74817
39 OR                            393032
40 PA                            391832
41 PR                             15420
42 RI                             35288
43 SC                             71799
44 SD                             16353
45 Space                              0
46 TN                            166575
47 TX                           1136339
48 UT                             93693
49 VA                            127368
50 VT                             68376
51 WA                            490261
52 WI                            211482
53 WV                             31804
54 WY                             11929</code></pre>
</div>
</div>
<p><code>summarize()</code> calculated the total number of attendees within each state. By default, R will print only the first 10 rows of the dataset. I used <code>print(n=Inf)</code> to force R to print all the rows.</p>
<p>We can also calculate the average number of attendees at a protest in each state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">pillar.sigfig=</span><span class="dv">5</span>) <span class="co"># less rounding</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total=</span><span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Average=</span><span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
   state   Total Average
   &lt;chr&gt;   &lt;int&gt;   &lt;dbl&gt;
 1 AK      35987  218.10
 2 AL      34919  231.25
 3 AR      21859  208.18
 4 AZ     224194  640.55
 5 CA    3190858 1191.1 
 6 CO     428654  865.97
 7 CT     106285  238.84
 8 DC    1460536 4651.4 
 9 DE      11280  163.48
10 FL     413328  382.36
11 GA     177400  476.88
12 GU        945   63   
13 HI      65548  550.82
14 IA     101200  328.57
15 ID      45776  293.44
16 IL     907239 1154.2 
17 IN      95985  195.49
18 KS      45736  245.89
19 KY     111992  288.64
20 LA      45151  226.89
21 MA     507235  604.57
22 MD      70662  245.35
23 ME      80716  271.77
24 MI     214651  257.99
25 MN     253084  562.41
26 MO     130153  309.15
27 MS      21677  216.77
28 MT      66652  320.44
29 NC     230558  347.75
30 ND      13599  209.22
31 NE      72351  411.09
32 NH      45947  268.70
33 NJ     166706  289.92
34 NM      88496  330.21
35 NV      95383  456.38
36 NY    1730569 1070.2 
37 OH     182713  295.65
38 OK      74817  413.35
39 OR     393032  517.15
40 PA     391832  352.05
41 PR      15420 1401.8 
42 RI      35288  273.55
43 SC      71799  276.15
44 SD      16353  247.77
45 Space       0  NaN   
46 TN     166575  470.55
47 TX    1136339 1228.5 
48 UT      93693  331.07
49 VA     127368  225.43
50 VT      68376  309.39
51 WA     490261  604.51
52 WI     211482  473.11
53 WV      31804  200.03
54 WY      11929  151   </code></pre>
</div>
</div>
<p>I used <code>options(pillar.sigfig=5)</code> to show more digits of precision in the output.</p>
<p>Interested in which “state” has the largest average protest size? Use <code>slice_max()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Average=</span><span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">n=</span><span class="dv">1</span>,Average)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  state Average
  &lt;chr&gt;   &lt;dbl&gt;
1 DC     4651.4</code></pre>
</div>
</div>
<p>We can also simply arrange the rows in descending order of average protest size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Average=</span><span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Average))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 2
   state Average
   &lt;chr&gt;   &lt;dbl&gt;
 1 DC    4651.4 
 2 PR    1401.8 
 3 TX    1228.5 
 4 CA    1191.1 
 5 IL    1154.2 
 6 NY    1070.2 
 7 CO     865.97
 8 AZ     640.55
 9 MA     604.57
10 WA     604.51
# ℹ 44 more rows</code></pre>
</div>
</div>
<section id="exercises-2" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="exercises-2"><span class="header-section-number">10.1</span> Exercises</h2>
<ol start="10" type="1">
<li>Are civil rights protests larger on average than non-civil rights protests? (Hint: use group_by/summarize)</li>
</ol>
</section>
</section>
<section id="pivot_widerpivot_longer" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> <code>pivot_wider()</code>/<code>pivot_longer()</code></h1>
<p>Note: You may encounter code with <code>melt()</code>, <code>cast()</code>, <code>reshape()</code>, <code>gather()</code>, and <code>spread()</code>. All of these are legacy versions of <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<p><code>pivot_wider()</code> and <code>pivot_longer()</code> reorganize datasets between “wide” and “long” form. <code>pivot_longer()</code> takes many side-by-side columns (say, one column per year) and stacks them into two neat columns, one that says “which year” and one that shows the value, so your table becomes taller and easier to plot or compare. <code>pivot_wider()</code> does the opposite. It takes a tall list of items (like many rows per state and year) and spreads them back out so each thing gets its own column, making the table wider and easier to read at a glance.</p>
<p><code>pivot_wider()</code> and <code>pivot_longer()</code> are in the <code>tidyr</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say that we are interested in determining which states have fewer civil rights protesters than non-civil rights protesters. With our existing <code>group_by()</code> and <code>sumamrize()</code> skills we can tabulate the number of protesters by state and by type of protest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(state, civilrights) <span class="sc">|&gt;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totAttendees =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 × 3
# Groups:   state [54]
   state civilrights totAttendees
   &lt;chr&gt;       &lt;dbl&gt;        &lt;int&gt;
 1 AK              0        15512
 2 AK              1        20475
 3 AL              0        11321
 4 AL              1        23598
 5 AR              0         8902
 6 AR              1        12957
 7 AZ              0       124949
 8 AZ              1        99245
 9 CA              0       701194
10 CA              1      2489664
# ℹ 97 more rows</code></pre>
</div>
</div>
<p>Now we can see the protester counts for civil rights and non-civil rights protest for each state. However, it is not clear how to compare the rows within each state.</p>
<p>This is where <code>pivot_wider()</code> comes in handy. We tell <code>pivot_wider()</code> to take the <code>civilrights</code> column and spread its values across columns, creating a column for non-civil rights protester counts and another column for civil rights protester counts. The values that will fill the new table come from <code>totAttendees</code>. Since <code>civilrights</code> takes values 0 and 1, I have asked <code>pivot_wider()</code> to paste “CR” in front of the values so that we get valid R column names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(state, civilrights) <span class="sc">|&gt;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totAttendees =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> civilrights,</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_from =</span> totAttendees,</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"CR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
# Groups:   state [54]
   state    CR0     CR1
   &lt;chr&gt;  &lt;int&gt;   &lt;int&gt;
 1 AK     15512   20475
 2 AL     11321   23598
 3 AR      8902   12957
 4 AZ    124949   99245
 5 CA    701194 2489664
 6 CO     88782  339872
 7 CT     52659   53626
 8 DC    477601  982935
 9 DE      5507    5773
10 FL    222991  190337
# ℹ 44 more rows</code></pre>
</div>
</div>
<p>Almost done. We just need to filter those with fewer civil rights protesters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(state, civilrights) <span class="sc">|&gt;</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totAttendees =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> civilrights,</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_from =</span> totAttendees,</span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"CR"</span>) <span class="sc">|&gt;</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(CR1 <span class="sc">&lt;</span> CR0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
# Groups:   state [11]
   state    CR0    CR1
   &lt;chr&gt;  &lt;int&gt;  &lt;int&gt;
 1 AZ    124949  99245
 2 FL    222991 190337
 3 GU       715    230
 4 HI     36868  28680
 5 ID     27156  18620
 6 IN     49362  46623
 7 MT     37871  28781
 8 OK     50503  24314
 9 PR     15320    100
10 VA     69230  58138
11 WV     24431   7373</code></pre>
</div>
</div>
<p>By spreading the columns out wide made it easier to make our calculation within each state. There is usually a way to avoid <code>pivot_wider()</code> and still get the right answer. For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">CR0 =</span> <span class="fu">sum</span>(<span class="fu">if_else</span>(civilrights <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>                              Attendees, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">CR1 =</span> <span class="fu">sum</span>(<span class="fu">if_else</span>(civilrights <span class="sc">==</span> <span class="dv">1</span>, </span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>                              Attendees, <span class="dv">0</span>, <span class="at">missing =</span> <span class="dv">0</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(CR1 <span class="sc">&lt;</span> CR0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   state    CR0    CR1
   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 AZ    124949  99245
 2 FL    222991 190337
 3 GU       715    230
 4 HI     36868  28680
 5 ID     27156  18620
 6 IN     49362  46623
 7 MT     37871  28781
 8 OK     50503  24314
 9 PR     15320    100
10 VA     69230  58138
11 WV     24431   7373</code></pre>
</div>
</div>
<p>This approach requires a little trick with the <code>if_else()</code>, including the value of <code>Attendees</code> in the sum if the associated protest is/is not a civil rights protest. Still, having <code>pivot_wider()</code> in your toolbox will come in handy.</p>
<p>Let’s try an example that is a little more complicated. We will determine which states had the largest percent increase in protesters in 2020 compared to the average annual number of protesters 2017-2019. For each state we need a total for 2020 and an average annual number across 2017, 2018, and 2019.</p>
<p>First, let’s derive a few helpful columns. Extract the year from <code>Date</code> and label that year as either 2017-2019 or as 2020. Note that I used <code>2017_2019</code> with an underscore as the label since R can confuse a hyphen for a minus sign.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date <span class="sc">&lt;</span> <span class="st">"2021-01-01"</span>) <span class="sc">|&gt;</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substring</span>(Date, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">timePeriod =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2017</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2017_2019"</span>,</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2020"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Attendees, civilrights, Date, year, timePeriod) <span class="sc">|&gt;</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Attendees civilrights       Date year timePeriod
1      1500           0 2017-01-15 2017  2017_2019
2       300           1 2017-01-16 2017  2017_2019
3        20           0 2017-01-16 2017  2017_2019
4        NA           1 2017-01-16 2017  2017_2019
5       300           0 2017-01-18 2017  2017_2019
6        NA           0 2017-01-19 2017  2017_2019</code></pre>
</div>
</div>
<p>Second, we can get the total number of protesters by state and time period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date <span class="sc">&lt;</span> <span class="st">"2021-01-01"</span>) <span class="sc">|&gt;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substring</span>(Date, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">timePeriod =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2017</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2017_2019"</span>,</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2020"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(state, timePeriod) <span class="sc">|&gt;</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totProtesters =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 × 3
# Groups:   state [54]
   state timePeriod totProtesters
   &lt;chr&gt; &lt;chr&gt;              &lt;int&gt;
 1 AK    2017_2019          30781
 2 AK    2020                5196
 3 AL    2017_2019          26629
 4 AL    2020                7710
 5 AR    2017_2019          15652
 6 AR    2020                6197
 7 AZ    2017_2019         189960
 8 AZ    2020               33223
 9 CA    2017_2019        2797687
10 CA    2020              391038
# ℹ 97 more rows</code></pre>
</div>
</div>
<p>The results is still “grouped” at this point. Be sure to <code>ungroup()</code> so that subsequent calculations do not just occur within each group. The sequence group()/summarize()/ungroup() is so common that there is a shortcut using <code>.by</code>. Either <code>ungroup()</code> or use <code>.by</code>. Then we <code>pivot_wider()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date <span class="sc">&lt;</span> <span class="st">"2021-01-01"</span>) <span class="sc">|&gt;</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substring</span>(Date, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">timePeriod =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2017</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2017_2019"</span>,</span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2020"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totProtesters =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">.by =</span> <span class="fu">c</span>(state, timePeriod)) <span class="sc">|&gt;</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> timePeriod,</span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"year"</span>,</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_from =</span> totProtesters,</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 54 × 3
   state year2017_2019 year2020
   &lt;chr&gt;         &lt;int&gt;    &lt;int&gt;
 1 AK            30781     5196
 2 AL            26629     7710
 3 AR            15652     6197
 4 AZ           189960    33223
 5 CA          2797687   391038
 6 CO           382137    44987
 7 CT            75083    30427
 8 DC          1393990    64540
 9 DE             6935     4195
10 FL           331471    81351
# ℹ 44 more rows</code></pre>
</div>
</div>
<p>Finally, we are in a position to compute the percent change, sort, and display those states with the largest percentage change.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Date <span class="sc">&lt;</span> <span class="st">"2021-01-01"</span>) <span class="sc">|&gt;</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">substring</span>(Date, <span class="dv">1</span>, <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">timePeriod =</span> <span class="fu">ifelse</span>(year <span class="sc">%in%</span> <span class="dv">2017</span><span class="sc">:</span><span class="dv">2019</span>,</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2017_2019"</span>,</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"2020"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">totProtesters =</span> <span class="fu">sum</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">.by =</span> <span class="fu">c</span>(state, timePeriod)) <span class="sc">|&gt;</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> timePeriod,</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"year"</span>,</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_from =</span> totProtesters,</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">ave2017_2019 =</span> year2017_2019<span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">pctChange =</span> <span class="dv">100</span><span class="sc">*</span>(year2020<span class="sc">-</span>ave2017_2019)<span class="sc">/</span>ave2017_2019) <span class="sc">|&gt;</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(state, pctChange) <span class="sc">|&gt;</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_max</span>(pctChange, <span class="at">n =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  state pctChange
  &lt;chr&gt;     &lt;dbl&gt;
1 ND       180.08
2 SC       153.41
3 VA       128.58
4 LA       126.00
5 MS       125.13</code></pre>
</div>
</div>
</section>
<section id="graphics-and-plots" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Graphics and plots</h1>
<p>We will finish our introduction to R by exploring <code>Tags</code> a little more through some barplots and a word cloud.</p>
<p>I will start by a special version of <code>mostCommon()</code> that will take a collection of tags and return the most common tag. This will allow us to find the most common protest type in the dataset. This function splits up the tags as we did before, and then applies <code>mostCommon()</code> to the resulting collection of tags.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>mostCommonType <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  reasons <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(x, <span class="st">"; "</span>)</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  reasons <span class="ot">&lt;-</span> <span class="fu">unlist</span>(reasons)</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">mostCommon</span>(reasons) )</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co"># test it out</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Tags[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Healthcare; For Affordable Care Act"                      
 [2] "Civil Rights; For racial justice; Martin Luther King, Jr."
 [3] "Environment; For wilderness preservation"                 
 [4] "Civil Rights; For racial justice; Martin Luther King, Jr."
 [5] "Healthcare; For Planned Parenthood"                       
 [6] "Executive; Against 45th president"                        
 [7] "Executive; For 45th president; Counter protest"           
 [8] "Civil Rights; For racial justice; Against invited speaker"
 [9] "Executive; Against 45th president"                        
[10] "Civil Rights; For women's rights; Women's March"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mostCommonType</span>(dataProtest<span class="sc">$</span>Tags[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Civil Rights"</code></pre>
</div>
</div>
<p>Now we can use <code>mostCommonType()</code> to find the most common protest type in the dataset. Note that <code>mostCommonType()</code> can return more than one value. <code>summarize()</code> will complain if it gets more than one value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">mostCommonType</span>(Tags)) <span class="sc">|&gt;</span> </span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'state'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58 × 2
# Groups:   state [54]
   state `mostCommonType(Tags)` 
   &lt;chr&gt; &lt;chr&gt;                  
 1 AK    Civil Rights           
 2 AL    Civil Rights           
 3 AR    Civil Rights           
 4 AZ    Civil Rights           
 5 CA    Civil Rights           
 6 CO    Civil Rights           
 7 CT    Civil Rights           
 8 DC    Civil Rights           
 9 DE    Civil Rights           
10 FL    Civil Rights           
11 GA    Civil Rights           
12 GU    Civil Rights           
13 GU    Other                  
14 HI    Other                  
15 IA    Civil Rights           
16 ID    Civil Rights           
17 IL    Civil Rights           
18 IN    Civil Rights           
19 KS    Civil Rights           
20 KY    Civil Rights           
21 LA    Civil Rights           
22 MA    Civil Rights           
23 MD    Civil Rights           
24 ME    Civil Rights           
25 MI    Civil Rights           
26 MN    Civil Rights           
27 MO    Civil Rights           
28 MS    Civil Rights           
29 MT    Civil Rights           
30 NC    Civil Rights           
31 ND    Civil Rights           
32 NE    Civil Rights           
33 NH    Civil Rights           
34 NJ    Civil Rights           
35 NM    Civil Rights           
36 NV    Civil Rights           
37 NY    Civil Rights           
38 OH    Civil Rights           
39 OK    Civil Rights           
40 OR    Civil Rights           
41 PA    Civil Rights           
42 PR    Against corruption     
43 PR    Against state executive
44 PR    Executive              
45 RI    Civil Rights           
46 SC    Civil Rights           
47 SD    Civil Rights           
48 Space Against 45th president 
49 Space Executive              
50 TN    Civil Rights           
51 TX    Civil Rights           
52 UT    Civil Rights           
53 VA    Civil Rights           
54 VT    Civil Rights           
55 WA    Civil Rights           
56 WI    Civil Rights           
57 WV    Civil Rights           
58 WY    Civil Rights           </code></pre>
</div>
</div>
<p>So let’s redo that with <code>reframe()</code> instead. <code>reframe()</code> is like <code>summarize()</code> but allows for multiple values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="fu">mostCommonType</span>(Tags)) <span class="sc">|&gt;</span> </span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="cn">Inf</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58 × 2
   state `mostCommonType(Tags)` 
   &lt;chr&gt; &lt;chr&gt;                  
 1 AK    Civil Rights           
 2 AL    Civil Rights           
 3 AR    Civil Rights           
 4 AZ    Civil Rights           
 5 CA    Civil Rights           
 6 CO    Civil Rights           
 7 CT    Civil Rights           
 8 DC    Civil Rights           
 9 DE    Civil Rights           
10 FL    Civil Rights           
11 GA    Civil Rights           
12 GU    Civil Rights           
13 GU    Other                  
14 HI    Other                  
15 IA    Civil Rights           
16 ID    Civil Rights           
17 IL    Civil Rights           
18 IN    Civil Rights           
19 KS    Civil Rights           
20 KY    Civil Rights           
21 LA    Civil Rights           
22 MA    Civil Rights           
23 MD    Civil Rights           
24 ME    Civil Rights           
25 MI    Civil Rights           
26 MN    Civil Rights           
27 MO    Civil Rights           
28 MS    Civil Rights           
29 MT    Civil Rights           
30 NC    Civil Rights           
31 ND    Civil Rights           
32 NE    Civil Rights           
33 NH    Civil Rights           
34 NJ    Civil Rights           
35 NM    Civil Rights           
36 NV    Civil Rights           
37 NY    Civil Rights           
38 OH    Civil Rights           
39 OK    Civil Rights           
40 OR    Civil Rights           
41 PA    Civil Rights           
42 PR    Against corruption     
43 PR    Against state executive
44 PR    Executive              
45 RI    Civil Rights           
46 SC    Civil Rights           
47 SD    Civil Rights           
48 Space Against 45th president 
49 Space Executive              
50 TN    Civil Rights           
51 TX    Civil Rights           
52 UT    Civil Rights           
53 VA    Civil Rights           
54 VT    Civil Rights           
55 WA    Civil Rights           
56 WI    Civil Rights           
57 WV    Civil Rights           
58 WY    Civil Rights           </code></pre>
</div>
</div>
<p>So why does Puerto Rico show up three times in these results?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state<span class="sc">==</span><span class="st">"PR"</span>) <span class="sc">|&gt;</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Tags) <span class="sc">|&gt;</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="st">"; "</span>) <span class="sc">|&gt;</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   Against austerity measures           Day Without a Woman 
                            1                             1 
                     Families      Families Belong Together 
                            1                             1 
   For greater accountability            For racial justice 
                            1                             1 
           For women's rights             For worker rights 
                            1                             1 
                      May Day                        Police 
                            1                             1 
                 Civil Rights For compassionate immigration 
                            2                             2 
                  Immigration           For Puerto Rico aid 
                            2                             3 
                        Other            Against corruption 
                            4                            11 
      Against state executive                     Executive 
                           11                            11 </code></pre>
</div>
</div>
<p>There are three tags all with 11 protests each, a three-way tie for the largest number of protests. So <code>mostCommonType()</code> returns all three tags.</p>
<p>R has a lot of built-in functions for creating plots and graphics. We will use the <code>barplot()</code> function to create a bar plot of the average number of attendees at protests in each state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Attendees=</span><span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(a<span class="sc">$</span>Attendees, <span class="at">names.arg =</span> a<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Intro_to_R_protests_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The state name labels are two big so we can shrink the “character expansion” (<code>cex</code>) by half.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(a<span class="sc">$</span>Attendees, <span class="at">names.arg =</span> a<span class="sc">$</span>state, <span class="at">cex.names=</span><span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Intro_to_R_protests_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also make the plot horizontal.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(a<span class="sc">$</span>Attendees, <span class="at">names.arg =</span> a<span class="sc">$</span>state, </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names=</span><span class="fl">0.3</span>,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">horiz=</span><span class="cn">TRUE</span>, </span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="st">"seagreen"</span>,</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Intro_to_R_protests_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also create a bar plot of the number of protests for the top 5 reasons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>reasons <span class="ot">&lt;-</span> dataProtest<span class="sc">$</span>Tags <span class="sc">|&gt;</span> </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="st">";"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(reasons,</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="st">"Number of Protests"</span>,</span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Protest Reason"</span>,</span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex.names =</span> <span class="fl">0.6</span>) <span class="co"># shrink bar labels 30%</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="01_Intro_to_R_protests_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For figures and plots, always use a vector graphics format. That means export your graphics using SVG or EMF. These formats are scalable and will look good at any size. You can insert these graphics into Word, PowerPoint, or Google Docs. PNG graphics tend to look blurry in reports and presentations. Show some pride in your data work by making sure that your final product looks great. Stick with SVG or EMF or another vector graphics format.</p>
<p>We will end with a beautiful word cloud of the protest tags.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud2)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>dataProtest<span class="sc">$</span>Tags <span class="sc">|&gt;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">strsplit</span>(<span class="at">split=</span><span class="st">"; "</span>) <span class="sc">|&gt;</span> </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">|&gt;</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wordcloud2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="wordcloud2 html-widget html-fill-item" id="htmlwidget-5ad4e3dedf4f715f5d6b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5ad4e3dedf4f715f5d6b">{"x":{"word":["Against 45th president","Against 46th president","Against abortion rights","Against accusations","Against administrative leave","Against advisor","Against affirmative action","Against Affordable Care Act","Against affordable housing","Against age limit","Against animal welfare","Against assisted suicide","Against austerity measures","Against backpack ban","Against better compensation","Against bikes","Against biofuels","Against bond","Against border wall","Against budget","Against bullying","Against business","Against cabinet member","Against cabinet nomination","Against candidate","Against capitalism","Against charter schools/vouchers","Against child abuse","Against child marriage","Against circumcision","Against city councilor","Against climate change","Against closure/relocation","Against colonization","Against Confederate symbol","Against congressional representative","Against continued investigation","Against contracting","Against corruption","Against crime","Against criminal justice reform","Against cult","Against cultural appropriation","Against curriculum changes","Against DACA","Against dams","Against data collection","Against death penalty","Against debt","Against decision","Against deregulation","Against development","Against discipline/conviction","Against disrespecting flag","Against donation","Against donor","Against dress code","Against drones","Against drugs","Against elder abuse","Against embassy move","Against eminent domain","Against eviction","Against exclusion","Against existing curriculum","Against expanding coverage","Against external protesters","Against extracurricular changes","Against fees","Against firing/reassignment","Against forced intersex surgery","Against foreign government","Against fossil fuels","Against freedom of press","Against freedom of speech","Against gambling","Against gentrification","Against government overreach","Against greater accountability","Against greater funding","Against greater gun control","Against greater inclusion","Against Guantanamo Bay","Against hazardous conditions","Against higher minimum wage","Against hiring","Against homeless residents","Against hospitalists","Against human trafficking","Against ICE","Against imprisonment","Against increased prices","Against invited speaker","Against judge","Against kneeling","Against lame duck legislation","Against landscaping","Against layoffs","Against lobbying","Against logging","Against marijuana","Against mayor","Against media","Against merger","Against mining","Against mismanagement","Against monitoring","Against Naloxone","Against nationalism/fascism","Against needle exchange","Against noise","Against NRA","Against nuclear weapons","Against opioid epidemic","Against outsourcing","Against overcrowding","Against pandemic intervention","Against payday loans","Against pesticide","Against pharmaceutical pricing","Against Planned Parenthood","Against police presence","Against political repression","Against pornography","Against poverty","Against pricing carbon","Against privatization","Against progressive agenda","Against public transportation","Against punishment","Against quotas","Against rate changes","Against redistricting","Against referendum change","Against regulation","Against reimbursements","Against religious exemption","Against religious tolerance","Against renewable energy","Against rent control","Against research findings","Against resource allocation","Against restricting access","Against revising treatment standards","Against ride share","Against safe spaces","Against sales","Against sanctuary city/state","Against schedule change","Against separation of church and state","Against sex offender","Against sexual/domestic violence","Against short-term rental","Against shutdown","Against single payer","Against slavery","Against smart meters","Against state congressional representative","Against state executive","Against strip club","Against Supreme Court nomination","Against systemic underfunding","Against takeover","Against tax","Against tax plan","Against teachers","Against technology","Against test-based evaluation","Against torture","Against tourism","Against trade agreement","Against transgender rights","Against travel ban","Against tree removal","Against underage drinking","Against understaffing","Against unionization","Against US intervention","Against vaccines","Against Veterans Affairs","Against violence","Against voter fraud commission","Against war","Against white supremacy","Against wilderness preservation","Against women's rights","Against worker rights","Against zoning","Air","Algeria","Amazon","Anti-LGBTQ","Anti-Muslim","Anti-Semitic","Antifa","Armenia","Armenian Genocide","Automation","Azerbaijan","Bangladesh","Benghazi","Black Women's March","Bolivia","Brazil","Burundi","Business","Cambodia","Campaign","Census","Cesar Chavez","Charlottesville","China","Church","Civil Rights","Climate Strike","Clothing","Collective Bargaining","Congo","Conspiracy theory","Coronavirus","Counter protest","Cuba","Day Without a Woman","Day Without Immigrants","Dijibouti","Drugs/Alcohol","Education","Egypt","Employment","Environment","EPA","Ethiopia","Executive","Facebook","Families","Families Belong Together","Farming","For 45th president","For 46th president","For abortion rights","For affirmative action","For Affordable Care Act","For affordable housing","For animal welfare","For assisted suicide","For better compensation","For better maternal care","For bikes","For biofuels","For bond","For border wall","For breastfeeding","For budget","For business","For candidate","For carbon tax","For changing meal plan","For charter schools","For child abuse","For child care","For CHIP","For city councilor","For clemency","For climate change","For closure/relocation","For colonization","For compassionate immigration","For Confederate symbol","For congressional representative","For conservative agenda","For constitutional convention","For consumer protections","For continued investigation","For continuity of coverage","For contracting","For criminal justice","For criminal justice reform","For DACA","For dams","For death penalty","For development","For disability rights","For discipline/conviction","For equitable custody","For expanding coverage","For extracurricular changes","For family welfare benefits","For firing/reassignment","For food security","For foreign government","For fossil fuels","For free tuition","For freedom of assembly","For freedom of press","For freedom of speech","For gambling","For greater access","For greater accountability","For greater awareness","For greater funding","For greater gun control","For greater immigration constraints","For greater inclusion","For greater participation","For greater regulation","For greater safety","For greater taxes","For greater transparency","For higher minimum wage","For hiring","For historic preservation","For homeless residents","For homeschooling","For human rights","For ICE","For improving infrastructure","For independence","For invited speaker","For Israel","For legalization","For library","For local services","For marijuana","For mayor","For Medicaid","For Medicare","For mining","For monitoring","For more permissive enrollment","For Naloxone","For nationalism","For needle exchange","For net neutrality","For nudity","For opioid access","For opportunity","For Palestine","For pandemic intervention","For pensions","For pesticide","For pet","For Planned Parenthood","For political prisoner release","For preschool","For privacy rights","For progressive agenda","For property rights","For public transportation","For Puerto Rico aid","For punishment","For racial justice","For recognition","For redistricting","For refugees","For religious tolerance","For renewable energy","For rent control","For restricting access","For revising treatment standards","For ride share","For safety net","For sales","For sanctuary city/state","For schedule change","For school security","For science","For senior services","For separation of church and state","For sexual/domestic violence","For short-term rental","For single payer","For smoking","For special-needs","For state congressional representative","For state executive","For status quo","For supporting police","For Supreme Court nomination","For tax","For tax plan","For Temporary Protected Status","For term limits","For test-based admissions","For tourism","For trade agreement","For transgender rights","For travel ban","For treatment","For unionization","For universal health care","For US intervention","For vaccines","For veteran services","For vocational programs","For vouchers","For war","For whistleblowing","For white supremacy","For wilderness preservation","For women's rights","For worker rights","Google","Guns","Hazing","Healthcare","HIV/AIDS","Honduras","Hong Kong","Housing","Identification","Immigration","Impeachment","India","Insurance","International","International Women's Day","Iran","Iraq","Israel","Journalism","Judicial","Large corporation","Lebanon","Legislative","Local governance","March for Our Lives","March for Science","March for Truth","Marijuana","Martin Luther King, Jr.","May Day","Mental health","Mexico","Military","Missing person","Moral Monday","Myanmar","National anthem","National Walkout Day","Native Americans","Natural disaster","Nigeria","North Korea","Other","Pakistan","Pardon","Paris Climate Accord","Park","People's Climate March","Philippines","Plastic","Playground","Poland","Police","Poor People's Campaign","Post Office","Pride","Prisons","Pro-LGBTQ","Rally Against Domestic Violence","Recess Rally","Religious practice","Russia","Sex workers","Smartphone","Sports","State budget","State constitution","Street vendor","Sudan","Supreme Court","Syria","Take Back the Night","Tax returns","Tea Party","Tibet","Togo","Transportation","Tuition","Turkey","Uber","Utility","Venezuela","Vietnam","Voting","War monument","Water","Wear Orange","Women's March","Yemen"],"freq":[1543,3,444,2,6,12,2,1,7,4,9,1,2,1,2,3,1,4,165,223,45,177,46,62,71,4,61,88,3,20,10,741,195,70,301,184,1,1,40,16,8,1,1,47,2,2,1,33,1,1,4,316,11,6,1,1,20,12,26,1,17,6,99,1,6,1,1,8,39,403,2,184,542,1,1,3,31,15,3,1,367,3,8,944,6,1,42,1,91,168,2,61,157,2,9,5,1,206,6,9,12,32,3,6,8,317,14,1,3,3,16,9,16,45,33,3,1243,9,11,18,69,63,2,1,7,8,63,13,7,86,2,2,17,1,71,3,1,3,3,1,1,6,3,1,7,1,9,15,16,9,6,620,8,80,1,2,1,10,109,1,341,313,11,38,130,2,2,7,1,11,2,9,324,21,1,95,4,22,68,1,372,2,285,548,5,11,1,9,15,1,49,108,40,6,32,21,5,2,3,1,1,3,1,1,1,139,2,102,3,23,396,26,5,14807,365,3,1716,1,65,2375,1513,5,73,85,1,69,2087,2,1,1678,5,6,3302,16,1078,577,26,1086,75,419,2,406,103,306,2,912,8,18,2,9,27,10,18,15,35,1,4,16,1,10,1,4,1,1,3,17,2220,183,31,14,3,1,55,2,1,130,164,432,2,2,42,28,3,4,57,2,2,124,14,11,12,3,93,2,37,1,39,8376,57,99,3000,72,209,137,14,100,9,71,118,1,49,180,1,4,7,14,4,3,14,1,11,85,78,5,36,3,1,1,2,1,2,1,26,5,19,3,80,88,26,1,1,97,1,6,9,147,2,54,28,2,10575,1,22,30,157,19,25,18,8,1,98,3,90,3,1,147,18,4,4,5,24,2,10,2,4,12,443,33,17,3,26,1,7,1,2,177,2,3,183,10,25,5,26,1,34,6,1,491,110,1127,413,12,3467,1,1906,1,1,14,83,1,3543,465,45,3,662,31,182,3,119,5,384,1,3,481,51,510,140,59,4,307,152,64,1,66,9,1,4,197,1312,113,2,8,9,4556,2,2,11,24,65,20,10,1,1,8254,96,207,152,205,490,8,50,5,70,5,1,62,3,2,2,10,1,48,32,94,8,7,1,183,29,8,33,75,36,2,532,2,88,31,975,3],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":0.01215641250759776,"backgroundColor":"white","gridSize":0,"minRotation":-0.7853981633974483,"maxRotation":0.7853981633974483,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
</div>
</section>
<section id="review" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Review</h1>
<p>As you saw in this script, R has a lot of functions. We started of figuring how to set our file path so R knows where to look for files. We loaded the data from a .RData file and we listed all the objects in R’s environment.</p>
<ul>
<li><code>setwd()</code> set working directory</li>
<li><code>load()</code> load R objects saved in a .RData file</li>
<li><code>ls()</code> list objects in the R environment</li>
</ul>
<p>R, of course, has all the basic math operations that you might need to do with a set of numbers. Like</p>
<ul>
<li><code>sqrt()</code></li>
<li><code>log()</code>, note that <code>log()</code> is the natural log as it is in most mathematical programming languages</li>
<li><code>round()</code> round to the nearest integer</li>
<li><code>abs()</code> absolute value</li>
<li><code>length()</code> number of elements in a collection</li>
<li><code>cumsum()</code> cumulative sum</li>
<li><code>sum()</code>, <code>mean()</code>, <code>median()</code>, <code>min()</code>, <code>max()</code></li>
</ul>
<p>Then we worked through some basic functions to work with R objects.</p>
<ul>
<li><code>c()</code> combine numbers and other R objects together in a collection</li>
<li><code>nrow()</code>, <code>ncol()</code></li>
<li><code>head()</code>, <code>tail()</code></li>
</ul>
<p>When working with datasets, we covered all the standard functions needed to manipulate data.</p>
<ul>
<li><code>slice()</code>, <code>slice_max()</code>, <code>slice_min()</code> pick out rows by there position in the dataset or by the max/min values</li>
<li><code>filter()</code> pick out rows based on a logical expression about what is in that row</li>
<li><code>select()</code> pick out columns by name</li>
<li><code>count()</code> count the number of rows in a dataset or the number of rows in a dataset by groups</li>
<li><code>mutate()</code> create new columns or edit existing columns</li>
<li><code>str_sub()</code> extract substrings from a string</li>
<li><code>case_match()</code> used inside <code>mutate()</code> to create new columns based on the values in another column</li>
<li><code>group_by()</code>, <code>summarize()</code>, <code>reframe()</code> used to summarize data by groups</li>
<li><code>arrange()</code> sort rows in a dataset</li>
<li><code>pivot_wider()</code> and <code>pivot_longer()</code> to organize data in wide or long form</li>
</ul>
<p>We also covered some more advanced functions.</p>
<ul>
<li><code>grepl()</code> search for patterns in text</li>
<li><code>summary()</code> get a summary of a dataset or any set of numbers</li>
<li><code>sort()</code> sort a collection of numbers</li>
<li><code>unlist()</code> remove the list structure from a list</li>
<li><code>names()</code> get the names of the elements in a collection</li>
<li><code>as.numeric()</code> convert objects to numbers, we specifically converted logical values to 1s and 0s</li>
<li><code>strsplit()</code> split a string into a list of substrings</li>
</ul>
<p>And we made some graphics too.</p>
<ul>
<li><code>barplot()</code> create a bar plot</li>
<li><code>wordcloud2()</code> create a word cloud</li>
</ul>
<p>In addition we even created our own new functions!</p>
<ul>
<li><code>mostCommon()</code> find the most common value in a collection</li>
<li><code>mostCommonType()</code> find the most common tag in a string containing semi-colon separated tags</li>
</ul>
<p>Before looking at the solutions, try out the exercises for yourself. All the skills you will be learning build on the fundamentals presented in this script. It would be a good idea to go through this a second time to make sure you understand everything.</p>
</section>
<section id="solutions-to-the-exercises" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Solutions to the exercises</h1>
<ol type="1">
<li>What is the date of the protest in line 10000 of the dataset?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice</span>(<span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Date
1 2018-03-24</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>Which protest type is in line 4289 of the dataset?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice</span>(<span class="dv">4289</span>) <span class="sc">|&gt;</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(Tags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                  Tags
1 International; For Palestine; Israel</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>How many protests occurred in your home state?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(state <span class="sc">==</span> <span class="st">"CA"</span>) <span class="sc">|&gt;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     n
1 4439</code></pre>
</div>
</div>
<ol start="4" type="1">
<li>Where did the protest in the last row of the full dataset occur?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(state, Location) <span class="sc">|&gt;</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tail</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      state          Location
38096    CA San Francisco, CA</code></pre>
</div>
</div>
<ol start="5" type="1">
<li>Which state had the most protests?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_max</span>(n, </span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">with_ties =</span> <span class="cn">TRUE</span>) <span class="co"># in case of ties</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state    n
1    CA 4439</code></pre>
</div>
</div>
<ol start="6" type="1">
<li>Which state had the least protests?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_min</span>(n, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state n
1 Space 1</code></pre>
</div>
</div>
<ol start="7" type="1">
<li>Which state had the most civil rights protests?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(civilrights<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_max</span>(n, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state    n
1    CA 1424</code></pre>
</div>
</div>
<ol start="8" type="1">
<li>Create a new column that is 1 if the protest has the tag ‘Against pandemic intervention’</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="ot">&lt;-</span> dataProtest <span class="sc">|&gt;</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">pandemic =</span> <span class="fu">as.numeric</span>(<span class="fu">grepl</span>(<span class="st">"Against pandemic intervention"</span>, Tags)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="9" type="1">
<li>Which state had the most protests against pandemic interventions?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(pandemic <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">count</span>(state) <span class="sc">|&gt;</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">slice_max</span>(n, <span class="at">with_ties =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  state   n
1    CA 227</code></pre>
</div>
</div>
<ol start="10" type="1">
<li>Are civil rights protests larger on average than non-civil rights protests?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>dataProtest <span class="sc">|&gt;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(civilrights) <span class="sc">|&gt;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="fu">mean</span>(Attendees, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  civilrights `mean(Attendees, na.rm = TRUE)`
        &lt;dbl&gt;                           &lt;dbl&gt;
1           0                          342.17
2           1                         1113.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Yes, civil rights protests are larger on average than non-civil rights protests.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>